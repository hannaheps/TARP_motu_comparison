---
title: "seabirds_vs_fish"
author: "CEB"
date: '2023-10-03'
output: html_document
---

#load packages
```{r}
library(tidyverse)

library(lme4)
library(car)
library(jtools)

library(emmeans)

library(corrplot)

library(vegan)

```




#load data
```{r}
seabirds <- read.csv("../output/n15_seabirds_combined_no_iti.csv", strip.white = T, header = T)
load("../../fish_benthic_surveys/output/data/fish_community_data.Rdata")

fish_bio_dat<-nmds_fish_diet_log_bio_site_scores

```



#merge data
```{r}
fish_bio_dat

#make combined site name column in fish data
fish_bio_dat2<-
  fish_bio_dat%>%
  mutate(protection = if_else(wind.exposure == "leeward", "Protected", "Exposed"))%>%
  relocate(protection, .before = wind.exposure)%>%
    mutate(motu = str_to_title(motu))%>%
  unite("site.name", c(motu, protection), sep = "_", remove = FALSE)


fish_bio_dat2

fish.bio.seabirds<-left_join(fish_bio_dat2,
                            select(seabirds, c("site.name", "breeding_biomass_kgha_side")), 
                                   by = "site.name")%>%
  mutate(site.name = as.factor(site.name))
fish.bio.seabirds

```

###------SEABIRDS VS. FISH BIOMASS (BY FEEDING GROUP)----------------

#do some quick plots of data:
```{r}

fish.bio.seabirds%>%
  ggplot(aes(x = breeding_biomass_kgha_side, y = Herb))+
  geom_point()+
  geom_smooth(method = "lm")

fish.bio.seabirds%>%
  ggplot(aes(x = breeding_biomass_kgha_side, y = InvMob))+
  geom_point()+
  geom_smooth(method = "lm")

fish.bio.seabirds%>%
  ggplot(aes(x = breeding_biomass_kgha_side, y = Omnivr))+
  geom_point()+
  geom_smooth(method = "lm")


fish.bio.seabirds%>%
  ggplot(aes(x = breeding_biomass_kgha_side, y = Plktiv))+
  geom_point()+
  geom_smooth(method = "lm")


fish.bio.seabirds%>%
  ggplot(aes(x = breeding_biomass_kgha_side, y = FisCep))+
  geom_point()+
  geom_smooth(method = "lm")


fish.bio.seabirds%>%
  ggplot(aes(x = breeding_biomass_kgha_side, y = InvSes))+
  geom_point()+
  geom_smooth(method = "lm")

##stacked bar plot
fish.bio.seabirds%>%
  pivot_longer(cols = c(Herb:InvSes),
                                          names_to = "feeding_group",
                                          values_to = "biomass_kg_ha")%>%
  group_by(feeding_group, site.name)%>%
  summarize(mean_biomass = mean(biomass_kg_ha))%>%
  ggplot(aes(fill = feeding_group, y = mean_biomass, x = site.name))+
  geom_bar(position = "stack", stat =  "identity")

#some variation


##format stacked bar: ----
fish_fg_bio_stack_barplot<-
fish.bio.seabirds%>%
  pivot_longer(cols = c(Herb:InvSes),
                                          names_to = "feeding_group",
                                          values_to = "biomass_kg_ha")%>%
  group_by(feeding_group, site.name)%>%
  summarize(mean_biomass = mean(biomass_kg_ha))%>%
  mutate(feeding_group = as.factor(feeding_group))%>%
  mutate(feeding_group = fct_relevel(feeding_group, c("Herb", "Omnivr", "Plktiv", "InvSes", "InvMob", "FisCep")))%>%
  ggplot(aes(fill = feeding_group, y = mean_biomass, x = site.name))+
  geom_bar(position = "stack", stat =  "identity")+
  scale_fill_brewer(palette = "Set2")+
  xlab("")+
  ylab("mean biomass (kg/ha)")+
    theme_bw()+
  theme(panel.grid.major = element_blank(), # remove gridlines
        panel.grid.minor = element_blank(), #remove gridlines
        strip.background = element_blank(),
        axis.text.x = element_text(angle = 45, hjust = 1)
        )
  
fish_fg_bio_stack_barplot
  
ggsave(fish_fg_bio_stack_barplot, file = "../output/seabird-fish/fish_fg_bio_stack_barplot.jpg",
       width = 7, height = 5)



```



#do corrplots:
```{r}
fish.bio.seabirds

corr_mat_fish_bio_sb<-as.data.frame(fish.bio.seabirds[,7:16])


cor.mtest(corr_mat_fish_bio_sb)
correlation.matrix <- cor(corr_mat_fish_bio_sb, use = "pairwise.complete.obs")
correlation.matrix
write.csv(correlation.matrix, "../output/seabird-fish/seabirds_fish_bio_fg_corrmatrix.csv")


corrplot(cor(corr_mat_fish_bio_sb, use = "pairwise.complete.obs"), type = "upper",
         addCoef.col = NULL, addCoefasPercent = FALSE, tl.col = "black", tl.cex = 0.5, title = "Seabirds-Fish FG")


pdf(file = "../output/seabird-fish/seabirds_fish_bio_fg_corrplot.pdf")

corrplot(cor(corr_mat_fish_bio_sb, use = "pairwise.complete.obs"), type = "upper",
         addCoef.col = NULL, addCoefasPercent = FALSE, tl.col = "black", tl.cex = 0.5, title = "Seabirds-Fish FG")

dev.off()

#pretty weak corr's, not much happening...
```


##need to also add in transect metadata
```{r}

#load data-----
tet_trans_meta<-read.csv("../../metadata/fish_benthic_focal_transect_metadata.csv", stringsAsFactors = TRUE)
str(tet_trans_meta)

#make site name to do easy merge:----
tet_trans_meta2<-
  tet_trans_meta%>%
  rename_all(str_to_lower)%>%
  mutate(protection = if_else(exposure == "Leeward", "Protected", "Exposed"))%>%
  relocate(protection, .before = exposure)%>%
    mutate(motu = str_to_title(motu))%>%
  unite("site.name", c(motu, protection), sep = "_", remove = FALSE)

tet_trans_meta2

fish.bio.seabirds.trans<-right_join(select(tet_trans_meta2, c("site.name", "transect", "start_distance_to_shore_m",
                                                             "end_distance_to_shore_m", "depth_min_m", "depth_max_m", "structural_complexity_0to5",
                                                             "transect.location")),
                                          fish.bio.seabirds,
                                          by = c("site.name", "transect"))%>%
  relocate(breeding_biomass_kgha_side, .after = rat.eradication.status)
  
fish.bio.seabirds.trans

```

#do simple linear models for feeding groups biomass
```{r}


#each group seperately:----
sb_fish_fg_bio_mod1<-lmer(Herb~breeding_biomass_kgha_side + wind.exposure + structural_complexity_0to5 + depth_max_m + start_distance_to_shore_m + (1|site.name), data = fish.bio.seabirds.trans)
#SINGULAR
summary(sb_fish_fg_bio_mod1)
plot(sb_fish_fg_bio_mod1)
vif(sb_fish_fg_bio_mod1)


sb_fish_fg_bio_mod2<-lmer(Herb~breeding_biomass_kgha_side + (1|site.name), data = fish.bio.seabirds.trans)
#STILL SINGULAR


sb_fish_fg_bio_mod3<-lmer(Herb~breeding_biomass_kgha_side + wind.exposure + structural_complexity_0to5 + depth_max_m + start_distance_to_shore_m + (1|motu), data = fish.bio.seabirds.trans)
#now okay

summary(sb_fish_fg_bio_mod3)
plot(sb_fish_fg_bio_mod3)
vif(sb_fish_fg_bio_mod3)

plot_summs(sb_fish_fg_bio_mod3)
#nothing happening....


sb_fish_fg_bio_log_mod3<-lmer(log(Herb)~log(breeding_biomass_kgha_side) + wind.exposure + structural_complexity_0to5 + depth_max_m + start_distance_to_shore_m + (1|motu), data = fish.bio.seabirds.trans)
#now okay

summary(sb_fish_fg_bio_log_mod3)
plot(sb_fish_fg_bio_log_mod3)
vif(sb_fish_fg_bio_log_mod3)

plot_summs(sb_fish_fg_bio_log_mod3)
#looks slightly better, but still nothing happening....


##all groups together-----
fish.bio.seabirds.trans.long<-
  fish.bio.seabirds.trans%>%
  select(-c(Distance_to_centroid, NMDS1, NMDS2))%>%
   pivot_longer(cols = c(Herb:InvSes),
                                          names_to = "feeding_group",
                                          values_to = "biomass_kg_ha")
fish.bio.seabirds.trans.long



sb_fish_fg_bio_all_mod<-lmer(biomass_kg_ha~breeding_biomass_kgha_side*feeding_group + wind.exposure*feeding_group + structural_complexity_0to5*feeding_group + depth_max_m*feeding_group + start_distance_to_shore_m*feeding_group + (1|motu), data = fish.bio.seabirds.trans.long)
#now okay

summary(sb_fish_fg_bio_all_mod)
plot(sb_fish_fg_bio_all_mod) #not great
vif(sb_fish_fg_bio_all_mod)
Anova(sb_fish_fg_bio_all_mod)
#feeding group and seabird*feeding group sig

plot_summs(sb_fish_fg_bio_all_mod)

#use emmeans
emmip(sb_fish_fg_bio_all_mod, feeding_group ~ breeding_biomass_kgha_side, cov.reduce = range)


#do log-log
sb_fish_fg_bio_all_log_mod<-lmer(log(biomass_kg_ha+1)~log(breeding_biomass_kgha_side)*feeding_group + wind.exposure*feeding_group + structural_complexity_0to5*feeding_group + depth_max_m*feeding_group + start_distance_to_shore_m*feeding_group + (1|motu), data = fish.bio.seabirds.trans.long)
#now okay

summary(sb_fish_fg_bio_all_log_mod)
plot(sb_fish_fg_bio_all_log_mod) #better
vif(sb_fish_fg_bio_all_log_mod)
Anova(sb_fish_fg_bio_all_log_mod)
#feeding group only thing sig

plot_summs(sb_fish_fg_bio_all_log_mod)

#use emmeans
emmip(sb_fish_fg_bio_all_log_mod, feeding_group ~ breeding_biomass_kgha_side, cov.reduce = range)


#avoid rest of interactions
sb_fish_fg_bio_all_log_mod2<-lmer(log(biomass_kg_ha+1)~log(breeding_biomass_kgha_side)*feeding_group  + (1|site.name), data = fish.bio.seabirds.trans.long)
#now okay

summary(sb_fish_fg_bio_all_log_mod2)
plot(sb_fish_fg_bio_all_log_mod2) #better
vif(sb_fish_fg_bio_all_log_mod2)
Anova(sb_fish_fg_bio_all_log_mod2)
#feeding group only thing sig

plot_summs(sb_fish_fg_bio_all_log_mod2)

#use emmeans
emmip(sb_fish_fg_bio_all_log_mod2, feeding_group ~ breeding_biomass_kgha_side, cov.reduce = range)

##-----run one model for total biomass----
fish.bio.seabirds.trans.tot<-
  fish.bio.seabirds.trans%>%
  rowwise%>%
  mutate(total_fish_bio = sum(c_across(Herb:InvSes)))%>%
  ungroup
fish.bio.seabirds.trans.tot

fish.bio.seabirds.trans.tot%>%
  ggplot(aes(x = breeding_biomass_kgha_side, y = total_fish_bio))+
  geom_point()+
  geom_smooth(method = "lm")


fish.bio.seabirds.trans.tot%>%
  ggplot(aes(x = log(breeding_biomass_kgha_side), y = log(total_fish_bio)))+
  geom_point()+
  geom_smooth(method = "lm")

fish.bio.seabirds.trans.tot%>%
  ggplot(aes(x = structural_complexity_0to5, y = total_fish_bio))+
  geom_point()+
  geom_smooth(method = "lm")


##run model---
sb_fish_fg_bio_tot_mod<-lmer(total_fish_bio~breeding_biomass_kgha_side  + wind.exposure + structural_complexity_0to5 + depth_max_m + start_distance_to_shore_m + (1|site.name), data = fish.bio.seabirds.trans.tot)
summary(sb_fish_fg_bio_tot_mod)
plot(sb_fish_fg_bio_tot_mod)
Anova(sb_fish_fg_bio_tot_mod)


sb_fish_fg_bio_tot_mod2<-lmer(total_fish_bio~breeding_biomass_kgha_side  + wind.exposure + structural_complexity_0to5 + depth_max_m + start_distance_to_shore_m + (1|motu), data = fish.bio.seabirds.trans.tot)
summary(sb_fish_fg_bio_tot_mod2)
plot(sb_fish_fg_bio_tot_mod2)
Anova(sb_fish_fg_bio_tot_mod2)

plot_summs(sb_fish_fg_bio_tot_mod)
plot_summs(sb_fish_fg_bio_tot_mod2)


sb_fish_fg_bio_tot_log_mod2<-lmer(log(total_fish_bio)~breeding_biomass_kgha_side  + wind.exposure + structural_complexity_0to5 + depth_max_m + start_distance_to_shore_m + (1|motu), data = fish.bio.seabirds.trans.tot)
summary(sb_fish_fg_bio_tot_log_mod2)
plot(sb_fish_fg_bio_tot_log_mod2)
Anova(sb_fish_fg_bio_tot_log_mod2)
vif(sb_fish_fg_bio_tot_log_mod2)

plot_summs(sb_fish_fg_bio_tot_log_mod2)


##remove seabird as predictor and see-----
sb_fish_bio_tot_mod3<-lmer(total_fish_bio ~   wind.exposure + structural_complexity_0to5 + depth_max_m + start_distance_to_shore_m   + (1|site.name), data = fish.bio.seabirds.trans.tot)
summary(sb_fish_bio_tot_mod3)
plot(sb_fish_bio_tot_mod3)
Anova(sb_fish_bio_tot_mod3)
vif(sb_fish_bio_tot_mod3)

plot_summs(sb_fish_bio_tot_mod3)

#still not much happening, although if run model with ONLY structure then trend to significant...

###REALLY NOTHING HAPPENING HERE WITH ANY BIOMASS FEEDING GROUP, OR BIOMASS IN GENERAL METRIC. NOT SURE WHY EVEN STRUCTURE NOT SIG. --------

```


##-----------------do NMDS with seabird biomass as overlay - FEEDING GROUP, DENSITY------

#need to load and combine data
```{r}

fish_fg_dens_dat<-nmds_fish_diet_log_site_scores
fish_fg_dens_dat

#make combined site name column in fish data
fish_fg_dens_dat2<-
  fish_fg_dens_dat%>%
  mutate(protection = if_else(wind.exposure == "leeward", "Protected", "Exposed"))%>%
  relocate(protection, .before = wind.exposure)%>%
    mutate(motu = str_to_title(motu))%>%
  unite("site.name", c(motu, protection), sep = "_", remove = FALSE)


fish_fg_dens_dat2

fish.dens.seabirds<-left_join(fish_fg_dens_dat2,
                            select(seabirds, c("site.name", "breeding_biomass_kgha_side")), 
                                   by = "site.name")%>%
  mutate(site.name = as.factor(site.name))
fish.dens.seabirds

#and combine with transect metadata

fish.dens.seabirds.trans<-right_join(select(tet_trans_meta2, c("site.name", "transect", "start_distance_to_shore_m",
                                                             "end_distance_to_shore_m", "depth_min_m", "depth_max_m", "structural_complexity_0to5",
                                                             "transect.location")),
                                          fish.dens.seabirds,
                                          by = c("site.name", "transect"))%>%
  relocate(breeding_biomass_kgha_side, .after = rat.eradication.status)

fish.dens.seabirds.trans

```

#run nmds
```{r}

#create species matrix, and log
fish.log.dens.seabirds.trans_sp<-
  fish.dens.seabirds.trans%>%
  ungroup()%>%
  select(Herb:InvSes)

fish.log.dens.seabirds.trans_sp

fish.log.dens.seabirds.trans_sp_log<-
  log(fish.log.dens.seabirds.trans_sp+1)

#run nmds----
nmds_fish_log_dens<-metaMDS(fish.log.dens.seabirds.trans_sp_log, distance = "bray", trymax=200, k=2, autotransform = FALSE)
nmds_fish_log_dens
#2 axes stress = 0.09476996, so all good

plot(nmds_fish_log_dens)
scores(nmds_fish_log_dens, display="species")


#look at plot and centroids, for now just motu and exposure (so sitename). will need to add explanatory variables
plot(nmds_fish_log_dens)
ord.fit<-envfit(nmds_fish_log_dens~breeding_biomass_kgha_side+protection + start_distance_to_shore_m + depth_max_m + structural_complexity_0to5, data = fish.dens.seabirds.trans, na.rm=TRUE)
ord.fit #looks like nothing sig
plot(ord.fit)
#draw polygons and arrows
ordihull(nmds_fish_log_dens, fish.dens.seabirds.trans$breeding_biomass_kgha_side, pty=3)


#rotate by breeding seabird biomass so can more easily interpret----
nmds_fish_log_dens.rotate<-MDSrotate(nmds_fish_log_dens, fish.dens.seabirds.trans$breeding_biomass_kgha_side)
nmds_fish_log_dens.rotate

plot(nmds_fish_log_dens.rotate)
ord.fit<-envfit(nmds_fish_log_dens.rotate~breeding_biomass_kgha_side+protection + start_distance_to_shore_m + depth_max_m + structural_complexity_0to5, data = fish.dens.seabirds.trans, na.rm=TRUE)
ord.fit #marginal effect of seabirds, no effect of protection. 
plot(ord.fit)
#draw polygons and arrows
ordihull(nmds_fish_log_dens.rotate, fish.dens.seabirds.trans$breeding_biomass_kgha_side, pty=3)


##extract site/transect scores----
nmds_fish_log_dens_spp.sc <- as.data.frame(scores(nmds_fish_log_dens.rotate, "species"))  #Using the scores function from vegan to extract the species scores and convert to a data.frame
nmds_fish_log_dens_spp.sc<-
  nmds_fish_log_dens_spp.sc%>%
  rownames_to_column(var="Species") # create a column of species, from the rownames of species.scores


nmds_fish_log_dens_site.sc <- scores(nmds_fish_log_dens.rotate, display = "sites", shrink = FALSE) 
nmds_fish_log_dens_site.sc

#merge site.sc with metadata and dispersion
nmds_fish_log_dens_site_scores<-
  bind_cols(fish.dens.seabirds.trans$site.name,
                    as_tibble(nmds_fish_log_dens_site.sc))%>%
  rename('site.name' = '...1')
nmds_fish_log_dens_site_scores


#plot just to see----

#get hull data:
site.A1 <- nmds_fish_log_dens_site_scores[nmds_fish_log_dens_site_scores$site.name == "Aie_Exposed", ][chull(nmds_fish_log_dens_site_scores[nmds_fish_log_dens_site_scores$site.name == 
    "Aie_Exposed", c("NMDS1", "NMDS2")]), ]

site.A2 <- nmds_fish_log_dens_site_scores[nmds_fish_log_dens_site_scores$site.name == "Aie_Protected", ][chull(nmds_fish_log_dens_site_scores[nmds_fish_log_dens_site_scores$site.name == 
    "Aie_Protected", c("NMDS1", "NMDS2")]), ]  

site.Re1 <- nmds_fish_log_dens_site_scores[nmds_fish_log_dens_site_scores$site.name == "Reiono_Protected", ][chull(nmds_fish_log_dens_site_scores[nmds_fish_log_dens_site_scores$site.name == 
    "Reiono_Protected", c("NMDS1", "NMDS2")]), ]

site.Re2<- nmds_fish_log_dens_site_scores[nmds_fish_log_dens_site_scores$site.name == "Reiono_Exposed", ][chull(nmds_fish_log_dens_site_scores[nmds_fish_log_dens_site_scores$site.name == 
    "Reiono_Exposed", c("NMDS1", "NMDS2")]), ]  

site.Rm1 <- nmds_fish_log_dens_site_scores[nmds_fish_log_dens_site_scores$site.name == "Rimatuu_Protected", ][chull(nmds_fish_log_dens_site_scores[nmds_fish_log_dens_site_scores$site.name == 
    "Rimatuu_Protected", c("NMDS1", "NMDS2")]), ]

site.Rm2<- nmds_fish_log_dens_site_scores[nmds_fish_log_dens_site_scores$site.name == "Rimatuu_Exposed", ][chull(nmds_fish_log_dens_site_scores[nmds_fish_log_dens_site_scores$site.name == 
    "Rimatuu_Exposed", c("NMDS1", "NMDS2")]), ]  

hull.data <- rbind(site.A1, site.A2, site.Re1, site.Re2, site.Rm1, site.Rm2)  #combine
hull.data

ggplot() + 
  geom_text(data=video_spp.sc,aes(x=NMDS1,y=NMDS2,label=Species), alpha = .2) +  # add the species labels - 
  geom_point(data=nmds_fish_log_dens_site_scores,aes(x=NMDS1,y=NMDS2,colour=site.name, fill = site.name, pch = site.name), stat="identity", size=5, alpha = .9) +
  geom_polygon(data=hull.data,aes(x=NMDS1,y=NMDS2,fill=site.name,group=site.name),alpha=0.30) + # add the convex hulls
  theme_bw() + 
  theme(panel.grid.major = element_blank(), # remove gridlines
        panel.grid.minor = element_blank(), #remove gridlines
        strip.background = element_blank(), #remove gray boxes
        text = element_text(size=20))
        #legend.title = element_blank()) #remove legend title
        #legend.box.background = element_rect(colour = "black", fill='white', linetype='solid', size=1), 
       # legend.justification=c(1,.9), legend.position=c(1,.9))  #  fix legend

##add arrows
sb.scrs <- as.data.frame(scores(ord.fit, display = "vectors"))
sb.scrs <- cbind(sb.scrs, Species = rownames(sb.scrs))

nmds_fish_log_dens_spp.sc2<-
  nmds_fish_log_dens_spp.sc%>%
  mutate(Species= str_remove_all(Species, "_percent_cover"))

fish_dens_log_nmds_plot<-
ggplot() + 
  geom_text(data=nmds_fish_log_dens_spp.sc,aes(x=NMDS1,y=NMDS2,label=Species), alpha = .2) +  # add the species labels - 
  geom_point(data=nmds_fish_log_dens_site_scores,aes(x=NMDS1,y=NMDS2,colour=site.name, fill = site.name, pch = site.name), stat="identity", size=5, alpha = .9) +
  geom_polygon(data=hull.data,aes(x=NMDS1,y=NMDS2,fill=site.name,group=site.name),alpha=0.30) + # add the convex hulls
  coord_fixed() + ## need aspect ratio of 1!
  geom_segment(data = sb.scrs,
               aes(x = 0, xend = NMDS1, y = 0, yend = NMDS2),
               arrow = arrow(length = unit(0.25, "cm")), colour = "black") +
    geom_text(data = sb.scrs, aes(x = NMDS1, y = NMDS2, label = sb.scrs$Species),
            size = 3, vjust = 2)+
  theme_bw() + 
  theme(panel.grid.major = element_blank(), # remove gridlines
        panel.grid.minor = element_blank(), #remove gridlines
        strip.background = element_blank(), #remove gray boxes
        text = element_text(size=20))
        #legend.title = element_blank()) #remove legend title
        #legend.box.background = element_rect(colour = "black", fill='white', linetype='solid', size=1), 
       # legend.justification=c(1,.9), legend.position=c(1,.9))  #  fix legend

fish_dens_log_nmds_plot


#save plot
  
ggsave(fish_dens_log_nmds_plot, file = "../output/seabird-fish/fish_log_dens_fg_nmds_plot.jpg",
       width = 7, height = 5)

```


###--------------------LOOK AT FISH DIVERSITY METRICS (and overall density, biomass, etc.) VS. SEABIRD BIOMASS-----------

#Combine relevant data:
```{r}
tet_fish_dens_div_comm_dat
tet_fish_div_comm_tl_dat
nmds_fish_diet_log_site_scores
nmds_fish_diet_log_bio_site_scores

#total density, and diversity stats based on density:
fish_dens_div_dat<-
  tet_fish_dens_div_comm_dat%>%
  select(c(motu, site.name, wind.exposure, transect, shannon, evenness, sum_dens, PD, SR))%>%
  mutate(protection = if_else(wind.exposure == "leeward", "Protected", "Exposed"))%>%
  relocate(protection, .before = wind.exposure)%>%
  mutate(motu = str_to_title(motu))%>%
  unite("site.name", c(motu, protection), sep = "_", remove = FALSE)


#relative biomass by trophic level:
fish_tl_bio_dat<-
  tet_fish_div_comm_tl_dat%>%
  select(c(motu, site.name, wind.exposure, transect, rel_bio_TL1, rel_bio_TL2, rel_bio_TL3, rel_bio_TL4, rel_bio_TL5))%>%
   mutate(protection = if_else(wind.exposure == "leeward", "Protected", "Exposed"))%>%
  relocate(protection, .before = wind.exposure)%>%
  mutate(motu = str_to_title(motu))%>%
  unite("site.name", c(motu, protection), sep = "_", remove = FALSE)


#density by feeding group/diet:
fish_fg_dens_dat<-
  nmds_fish_diet_log_site_scores%>%
  select(c(motu, site.name, wind.exposure, transect, Herb, InvMob, Omnivr, Plktiv, FisCep, InvSes))%>%
  rename_with(~paste0(.,"_density"), Herb:InvSes)%>%
   mutate(protection = if_else(wind.exposure == "leeward", "Protected", "Exposed"))%>%
  relocate(protection, .before = wind.exposure)%>%
  mutate(motu = str_to_title(motu))%>%
  unite("site.name", c(motu, protection), sep = "_", remove = FALSE)
fish_fg_dens_dat


#biomass by feeding group/diet, and keep in metadata from above:
fish_fg_bio_dat<-
  fish.bio.seabirds.trans%>%
  select(c(motu, site.name,wind.exposure, transect, start_distance_to_shore_m, end_distance_to_shore_m, 
           depth_min_m, depth_max_m, structural_complexity_0to5, breeding_biomass_kgha_side, 
           Herb, InvMob, Omnivr, Plktiv, FisCep, InvSes))%>%
  rename_with(~paste0(.,"_biomass"), Herb:InvSes)%>%
    rowwise%>%
  mutate(sum_fish_biomass = sum(c_across(Herb_biomass:InvSes_biomass)))%>%
  ungroup

fish_fg_bio_dat


#now combine----
fish_comb_dat_1<- full_join(fish_dens_div_dat, fish_tl_bio_dat, by = c("motu", "site.name", "wind.exposure", "protection", "transect"))
fish_comb_dat_1

fish_comb_dat_2<- full_join(fish_comb_dat_1, fish_fg_dens_dat, by = c("motu", "site.name", "wind.exposure", "protection", "transect"))
fish_comb_dat_2


fish_comb_dat<- full_join(fish_fg_bio_dat, select(fish_comb_dat_2,-protection), by = c("motu", "site.name", "wind.exposure",  "transect"))
fish_comb_dat


##now do corr matrix----
fish_comb_dat_for_corr<-
  fish_comb_dat%>%
  select()

fish.bio.seabirds

fish_comb_dat_for_corr<-as.data.frame(fish_comb_dat[,5:33])


cor.mtest(fish_comb_dat_for_corr)
correlation.matrix <- cor(fish_comb_dat_for_corr, use = "pairwise.complete.obs")
correlation.matrix
write.csv(correlation.matrix, "../output/seabird-fish/seabirds_fish_all_corrmatrix.csv")


corrplot(cor(fish_comb_dat_for_corr, use = "pairwise.complete.obs"), type = "upper",
         addCoef.col = NULL, addCoefasPercent = FALSE, tl.col = "black", tl.cex = 0.5, title = "Seabirds-Fish FG")


pdf(file = "../output/seabird-fish/seabirds_fish_all_corrplot.pdf")

corrplot(cor(fish_comb_dat_for_corr, use = "pairwise.complete.obs"), type = "upper",
         addCoef.col = NULL, addCoefasPercent = FALSE, tl.col = "black", tl.cex = 0.5, title = "Seabirds-Fish FG")

dev.off()

#pretty weak corr's, not much happening...

```


####-------make bar plot of relative trophic levels------
```{r}

fish_tl_bio_stack_barplot<-
fish_comb_dat%>%
  pivot_longer(cols = c(rel_bio_TL1:rel_bio_TL5),
                                          names_to = "trophic_level",
                                          values_to = "relative_biomass")%>%
  group_by(trophic_level, site.name)%>%
  summarize(mean_rel_bio = mean(relative_biomass))%>%
  ggplot(aes(fill = trophic_level, y = mean_rel_bio, x = site.name))+
  geom_bar(position = "stack", stat =  "identity")+
  scale_fill_brewer(palette = "Set2")+
  xlab("")+
  ylab("mean relative biomass")+
    theme_bw()+
  theme(panel.grid.major = element_blank(), # remove gridlines
        panel.grid.minor = element_blank(), #remove gridlines
        strip.background = element_blank(),
        axis.text.x = element_text(angle = 45, hjust = 1)
        )
  
fish_tl_bio_stack_barplot
  
ggsave(fish_tl_bio_stack_barplot, file = "../output/seabird-fish/fish_trophic_level_rel_bio_stack_barplot.jpg",
       width = 7, height = 5)


```



##use seabird levels-----
```{r}
#total fish biomass----
fish_comb_dat_levels<-
  fish_comb_dat%>%
  mutate(seabird_level = case_when(breeding_biomass_kgha_side<10 ~"low",
                                   breeding_biomass_kgha_side>10&breeding_biomass_kgha_side <200 ~"mid",
                                   breeding_biomass_kgha_side>200 ~"high"))%>%
  mutate(seabird_level = as.factor(seabird_level))%>%
  mutate(seabird_level = fct_relevel(seabird_level, "low", "mid", "high"))%>%
  relocate(seabird_level, .before = breeding_biomass_kgha_side) 

fish_comb_dat_levels


sb_fish_bio_levels_mod1<-lmer(log(sum_fish_biomass)~seabird_level  + wind.exposure + structural_complexity_0to5 + depth_max_m + start_distance_to_shore_m + (1|motu), data = fish_comb_dat_levels)
summary(sb_fish_bio_levels_mod1)
Anova(sb_fish_bio_levels_mod1)

sb_fish_bio_levels_mod2<-lmer(log(sum_fish_biomass)~seabird_level  + wind.exposure + structural_complexity_0to5 + depth_max_m + start_distance_to_shore_m + (1|site.name), data = fish_comb_dat_levels)
summary(sb_fish_bio_levels_mod2)
Anova(sb_fish_bio_levels_mod2)


#reduce model:
sb_fish_bio_levels_mod2_r<-lmer(log(sum_fish_biomass)~seabird_level+ (1|site.name), data = fish_comb_dat_levels)
summary(sb_fish_bio_levels_mod2_r)
Anova(sb_fish_bio_levels_mod2_r)
plot_summs(sb_fish_bio_levels_mod2_r)
#MARGINAL EFFECT WHERE LOW SEABIRD ACTUALLY HAS HIGHEST BIOMASS

sb_fish_bio_levels_mod3_r<-lmer(log(sum_fish_biomass)~seabird_level+structural_complexity_0to5 +  (1|site.name), data = fish_comb_dat_levels)
summary(sb_fish_bio_levels_mod3_r)
Anova(sb_fish_bio_levels_mod3_r)
plot_summs(sb_fish_bio_levels_mod3_r)
#now no effect

sb_fish_bio_levels_mod3<-lmer(log(sum_fish_biomass)~seabird_level*structural_complexity_0to5 +  (1|site.name), data = fish_comb_dat_levels)
summary(sb_fish_bio_levels_mod3)
Anova(sb_fish_bio_levels_mod3)
plot_summs(sb_fish_bio_levels_mod3)

sb_fish_bio_levels_mod4_r<-lmer(log(sum_fish_biomass)~seabird_level+structural_complexity_0to5 + wind.exposure +  (1|site.name), data = fish_comb_dat_levels)
summary(sb_fish_bio_levels_mod4_r)
Anova(sb_fish_bio_levels_mod4_r)
plot_summs(sb_fish_bio_levels_mod4_r)


sb_fish_bio_levels_mod5_r<-lmer(log(sum_fish_biomass)~structural_complexity_0to5 + wind.exposure +  (1|site.name), data = fish_comb_dat_levels)
summary(sb_fish_bio_levels_mod5_r)
Anova(sb_fish_bio_levels_mod5_r)
plot_summs(sb_fish_bio_levels_mod5_r)


##look at diversity----
sb_fish_div_levels_mod1<-lmer(SR~seabird_level +  (1|site.name), data = fish_comb_dat_levels)
summary(sb_fish_div_levels_mod1)
Anova(sb_fish_div_levels_mod1)


sb_fish_div_levels_mod2<-lmer(SR~seabird_level + structural_complexity_0to5 + sum_fish_biomass+ (1|site.name), data = fish_comb_dat_levels)
summary(sb_fish_div_levels_mod2)
Anova(sb_fish_div_levels_mod2)
plot_summs(sb_fish_div_levels_mod2)
#higher diversity with higher fish biomass (BEF)


sb_fish_div_levels_mod3<-lmer(SR~seabird_level + structural_complexity_0to5 + sum_fish_biomass+ (1|motu), data = fish_comb_dat_levels)
summary(sb_fish_div_levels_mod3)
Anova(sb_fish_div_levels_mod3)
#higher diversity with higher fish biomass (BEF)

```

#run nmds with seabird levels overlayed
```{r}

fish.dens.seabirds.trans.level<-
  fish.dens.seabirds.trans%>%
    mutate(seabird_level = case_when(breeding_biomass_kgha_side<10 ~"low",
                                   breeding_biomass_kgha_side>10&breeding_biomass_kgha_side <200 ~"mid",
                                   breeding_biomass_kgha_side>200 ~"high"))%>%
  mutate(seabird_level = as.factor(seabird_level))%>%
  mutate(seabird_level = fct_relevel(seabird_level, "low", "mid", "high"))%>%
  relocate(seabird_level, .before = breeding_biomass_kgha_side) 


#look at plot and centroids, for now just motu and exposure (so sitename). will need to add explanatory variables
plot(nmds_fish_log_dens)
ord.fit.level<-envfit(nmds_fish_log_dens~seabird_level+protection + start_distance_to_shore_m + depth_max_m + structural_complexity_0to5, data = fish.dens.seabirds.trans.level, na.rm=TRUE)
ord.fit.level #looks like nothing sig
plot(ord.fit.level)
#draw polygons and arrows
ordihull(nmds_fish_log_dens, fish.dens.seabirds.trans$seabird_level, pty=3)


#rotate by breeding seabird biomass so can more easily interpret----
nmds_fish_log_dens.rotate<-MDSrotate(nmds_fish_log_dens, fish.dens.seabirds.trans$breeding_biomass_kgha_side)
nmds_fish_log_dens.rotate

plot(nmds_fish_log_dens.rotate)
ord.fit2<-envfit(nmds_fish_log_dens.rotate~seabird_level+protection + start_distance_to_shore_m + depth_max_m + structural_complexity_0to5, data = fish.dens.seabirds.trans.level, na.rm=TRUE)
ord.fit2 #marginal effect of seabirds, no effect of protection. 
plot(ord.fit2)
#draw polygons and arrows
ordihull(nmds_fish_log_dens.rotate, fish.dens.seabirds.trans$seabird_level, pty=3)


##extract site/transect scores----
nmds_fish_log_dens_spp.sc <- as.data.frame(scores(nmds_fish_log_dens.rotate, "species"))  #Using the scores function from vegan to extract the species scores and convert to a data.frame
nmds_fish_log_dens_spp.sc<-
  nmds_fish_log_dens_spp.sc%>%
  rownames_to_column(var="Species") # create a column of species, from the rownames of species.scores


nmds_fish_log_dens_site.sc <- scores(nmds_fish_log_dens.rotate, display = "sites", shrink = FALSE) 
nmds_fish_log_dens_site.sc

#merge site.sc with metadata and dispersion
nmds_fish_log_dens_site_scores<-
  bind_cols(fish.dens.seabirds.trans.level$seabird_level,
                    as_tibble(nmds_fish_log_dens_site.sc))%>%
  rename('seabird_level' = '...1')
nmds_fish_log_dens_site_scores


#plot just to see----

#get hull data:
site.low <- nmds_fish_log_dens_site_scores[nmds_fish_log_dens_site_scores$seabird_level == "low", ][chull(nmds_fish_log_dens_site_scores[nmds_fish_log_dens_site_scores$seabird_level == 
    "low", c("NMDS1", "NMDS2")]), ]

site.mid <- nmds_fish_log_dens_site_scores[nmds_fish_log_dens_site_scores$seabird_level == "mid", ][chull(nmds_fish_log_dens_site_scores[nmds_fish_log_dens_site_scores$seabird_level == 
    "mid", c("NMDS1", "NMDS2")]), ]  

site.high <- nmds_fish_log_dens_site_scores[nmds_fish_log_dens_site_scores$seabird_level == "high", ][chull(nmds_fish_log_dens_site_scores[nmds_fish_log_dens_site_scores$seabird_level == 
    "high", c("NMDS1", "NMDS2")]), ]


hull.data <- rbind(site.low, site.mid, site.high)  #combine
hull.data

ggplot() + 
  geom_text(data=nmds_fish_log_dens_spp.sc,aes(x=NMDS1,y=NMDS2,label=Species), alpha = .2) +  # add the species labels - 
  geom_point(data=nmds_fish_log_dens_site_scores,aes(x=NMDS1,y=NMDS2,colour=seabird_level, fill = seabird_level, pch = seabird_level), stat="identity", size=5, alpha = .9) +
  geom_polygon(data=hull.data,aes(x=NMDS1,y=NMDS2,fill=seabird_level,group=seabird_level),alpha=0.30) + # add the convex hulls
  theme_bw() + 
  theme(panel.grid.major = element_blank(), # remove gridlines
        panel.grid.minor = element_blank(), #remove gridlines
        strip.background = element_blank(), #remove gray boxes
        text = element_text(size=20))
        #legend.title = element_blank()) #remove legend title
        #legend.box.background = element_rect(colour = "black", fill='white', linetype='solid', size=1), 
       # legend.justification=c(1,.9), legend.position=c(1,.9))  #  fix legend

##add arrows
sb.scrs <- as.data.frame(scores(ord.fit, display = "vectors"))
sb.scrs <- cbind(sb.scrs, Species = rownames(sb.scrs))

fish_dens_log_nmds_plot<-
ggplot() + 
  geom_text(data=nmds_fish_log_dens_spp.sc,aes(x=NMDS1,y=NMDS2,label=Species), alpha = .2) +  # add the species labels - 
  geom_point(data=nmds_fish_log_dens_site_scores,aes(x=NMDS1,y=NMDS2,colour=seabird_level, fill = seabird_level, pch = seabird_level), stat="identity", size=5, alpha = .9) +
  geom_polygon(data=hull.data,aes(x=NMDS1,y=NMDS2,fill=seabird_level,group=seabird_level),alpha=0.30) + # add the convex hulls
  coord_fixed() + ## need aspect ratio of 1!
  geom_segment(data = sb.scrs,
               aes(x = 0, xend = NMDS1, y = 0, yend = NMDS2),
               arrow = arrow(length = unit(0.25, "cm")), colour = "black") +
    geom_text(data = sb.scrs, aes(x = NMDS1, y = NMDS2, label = sb.scrs$Species),
            size = 3, vjust = 2)+
  theme_bw() + 
  theme(panel.grid.major = element_blank(), # remove gridlines
        panel.grid.minor = element_blank(), #remove gridlines
        strip.background = element_blank(), #remove gray boxes
        text = element_text(size=20))
        #legend.title = element_blank()) #remove legend title
        #legend.box.background = element_rect(colour = "black", fill='white', linetype='solid', size=1), 
       # legend.justification=c(1,.9), legend.position=c(1,.9))  #  fix legend

fish_dens_log_nmds_plot



```




##manovas/individual lmms with seabird levels-----
```{r}
fish.dens.seabirds.trans.level

##try manova----
fish_comm.manova <- manova(cbind(Herb, InvMob, Omnivr, Plktiv, FisCep, InvSes) ~ seabird_level + wind.exposure + structural_complexity_0to5 + start_distance_to_shore_m + depth_min_m, data = fish.dens.seabirds.trans.level)
summary(fish_comm.manova)
#nothing is sig

fish_comm.manova2 <-  manova(cbind(Herb, InvMob, Omnivr, Plktiv, FisCep, InvSes) ~ seabird_level, data = fish.dens.seabirds.trans.level)
summary(fish_comm.manova2)
#seabird level is still not sig


fish_comm.manova2.log <-  manova(cbind(log(Herb+1), log(InvMob + 1), log(Omnivr+1), log(Plktiv+1), log(FisCep+1), log(InvSes+1)) ~ seabird_level, data = fish.dens.seabirds.trans.level)
summary(fish_comm.manova2.log)
#seabird level is still not sig

EMM_fish_comm_manova <- emmeans(fish_comm.manova2, ~seabird_level*rep.meas)
pairs(EMM_fish_comm_manova, simple = "seabird_level", type = "response")
test(pairs(EMM_fish_comm_manova, by = "rep.meas"), by = NULL, adjust = "mvt")


#plot:
plot_data_manova_fish<-emmip(fish_comm.manova2, ~ seabird_level*rep.meas,
          type = "response", CIs = TRUE, plotit=FALSE)

ggplot(data = plot_data_manova_fish, aes(x = rep.meas, y = yvar, color = seabird_level, fill = seabird_level))+
  geom_point(pch = 4,  position = position_dodge(.3))+
  geom_pointrange(aes(ymin = LCL, ymax = UCL), alpha = .3, linewidth = 5, size = 0,  position = position_dodge(.3)) + 
 # geom_point(data = fishn15.seabirds.cond.r, 
    #         aes(y = n15, x = species), size = 2.5, alpha = .5,  position = position_dodge(.3))+
  #scale_fill_manual(values = my_colors)+
 # scale_color_manual(values = my_colors) +
    ylab("biomass (kg/ha")+
  xlab("")+
  labs(color = "seabird level", fill = "seabird level")+
#  scale_x_discrete(label = c("hard coral", "pavement", "rubble", "sand", "macroalgae"))+
   theme_bw()+
  theme(panel.grid.major = element_blank(), # remove gridlines
        panel.grid.minor = element_blank(), #remove gridlines
        strip.background = element_blank(),
        legend.position = c(.83,.92),
        legend.direction = "horizontal",
        legend.box.background = element_rect(colour = "black"))


```


#run total biomass, diversity tests with seabird levels and algae n15 at 40 m------
```{r}
#combine data----
fish_comb_dat_levels
fish.dens.seabirds.trans.level #for nmds with density axes


fish_comb_dat_nmds_levels<- left_join(fish_comb_dat_levels, 
                                      select(fish.dens.seabirds.trans.level, c("site.name", "transect", "Distance_to_centroid", "NMDS1", "NMDS2")),
                                      by = c("site.name", "transect"))
fish_comb_dat_nmds_levels

#now add algae n15:
algae_n15<-read.csv("../output/n15_seabirds_combined_no_iti.csv")
algae_n15


fish_comb_dat_nmds_levels_algae<-left_join(fish_comb_dat_nmds_levels, 
                                            select(algae_n15, c("site.name", "N.15_at_10m",  "N.15_at_20m", "N.15_at_30m", "N.15_at_40m")),
                                            by = "site.name")

fish_comb_dat_nmds_levels_algae


#run lmms----
#total biomass----
fish_bio_full_mod_sb_level <-lmer(sum_fish_biomass~seabird_level  + wind.exposure + structural_complexity_0to5  + (1|site.name), data = fish_comb_dat_nmds_levels_algae) #depth_max_m + start_distance_to_shore_m
summary(fish_bio_full_mod_sb_level)
plot(fish_bio_full_mod_sb_level)
Anova(fish_bio_full_mod_sb_level) #nothing significant***
vif(fish_bio_full_mod_sb_level) #oh, seabird level may have high GVIF


#try with log:
fish_bio_full_mod_sb_level_log <-lmer(log(sum_fish_biomass+1)~seabird_level  + wind.exposure + structural_complexity_0to5  + (1|site.name), data = fish_comb_dat_nmds_levels_algae) #depth_max_m + start_distance_to_shore_m
summary(fish_bio_full_mod_sb_level_log)
plot(fish_bio_full_mod_sb_level_log)
Anova(fish_bio_full_mod_sb_level_log) #nothing significant***


#try LRTs
fish_bio_full_mod_sb_level_log_nosb <-lmer(log(sum_fish_biomass+1)~ wind.exposure + structural_complexity_0to5  + (1|site.name), data = fish_comb_dat_nmds_levels_algae) #depth_max_m + start_distance_to_shore_m
anova(fish_bio_full_mod_sb_level_log, fish_bio_full_mod_sb_level_log_nosb) # p = 0.2627

fish_bio_full_mod_sb_level_log_nosc <-lmer(log(sum_fish_biomass+1)~ seabird_level + wind.exposure + (1|site.name), data = fish_comb_dat_nmds_levels_algae) #depth_max_m + start_distance_to_shore_m
anova(fish_bio_full_mod_sb_level_log, fish_bio_full_mod_sb_level_log_nosc) # p = 0.8591


#remove seabirds:
fish_bio_red_mod <-lmer(sum_fish_biomass~ wind.exposure + structural_complexity_0to5 + (1|site.name), data = fish_comb_dat_nmds_levels_algae) #
summary(fish_bio_red_mod)
plot(fish_bio_red_mod)
Anova(fish_bio_red_mod) #still nothing significant, although trend for structural complexity (p = 0.1)
vif(fish_bio_red_mod) #
#when add: + depth_min_m+ start_distance_to_shore_m  - then depth min has trend (BUT NOT DEPTH MAX)


#only structure:
fish_bio_red_mod_structure <-lmer(log(sum_fish_biomass+1)~ structural_complexity_0to5 + (1|site.name), data = fish_comb_dat_nmds_levels_algae) #
Anova(fish_bio_red_mod_structure) #marginal, regardless of using log or non-log. p = .07 or p = .08


#re-run with algae at 30 m:
fish_bio_full_mod_algae <-lmer(sum_fish_biomass~N.15_at_30m  + wind.exposure + structural_complexity_0to5  + (1|site.name), data = fish_comb_dat_nmds_levels_algae) #
summary(fish_bio_full_mod_algae)
plot(fish_bio_full_mod_algae)
Anova(fish_bio_full_mod_algae) #nothing significant***
vif(fish_bio_full_mod_algae) #all good

fish_bio_full_mod_algae.40 <-lmer(sum_fish_biomass~N.15_at_40m  + wind.exposure + structural_complexity_0to5  + (1|site.name), data = fish_comb_dat_nmds_levels_algae) #SINGULAR BECAUSE NO DATA FOR 40 M AT AIE EXPOSED I THINK


#NMDS1----
fish_nmds1_full_mod_sb_level <-lmer(NMDS1~seabird_level  + wind.exposure + structural_complexity_0to5  + (1|site.name), data = fish_comb_dat_nmds_levels_algae) #depth_max_m + start_distance_to_shore_m
summary(fish_nmds1_full_mod_sb_level)
plot(fish_nmds1_full_mod_sb_level)
Anova(fish_nmds1_full_mod_sb_level) #nothing significant***
vif(fish_nmds1_full_mod_sb_level)

fish_nmds1_full_mod_algae <-lmer(NMDS1~N.15_at_30m  + wind.exposure + structural_complexity_0to5  + (1|site.name), data = fish_comb_dat_nmds_levels_algae) #depth_max_m + start_distance_to_shore_m
summary(fish_nmds1_full_mod_algae)
plot(fish_nmds1_full_mod_algae)
Anova(fish_nmds1_full_mod_algae) #N15 at 30m is marginal*** 
plot_summs(fish_nmds1_full_mod_algae)
#positive effect of n15 at 30 m on NMDS1 - need to double-check what species this is associated with. 

#alternative p-value calcualtions:
summ(fish_nmds1_full_mod_algae)
fish_nmds1_r_mod_algae <-lmer(NMDS1~  + wind.exposure + structural_complexity_0to5  + (1|site.name), data = fish_comb_dat_nmds_levels_algae) 
anova(fish_nmds1_full_mod_algae, fish_nmds1_r_mod_algae) # OH DANG, IWTH LRT THIS IS SIGNIFICANT - p = .03693


#NMDS2----
fish_nmds2_full_mod_sb_level <-lmer(NMDS2~seabird_level  + wind.exposure + structural_complexity_0to5  + (1|site.name), data = fish_comb_dat_nmds_levels_algae) #SINGULAR
summary(fish_nmds2_full_mod_sb_level)
plot(fish_nmds2_full_mod_sb_level)
Anova(fish_nmds2_full_mod_sb_level) #nothing significant***
vif(fish_nmds2_full_mod_sb_level)

fish_nmds2_full_mod_algae <-lmer(NMDS2~N.15_at_30m  + wind.exposure + structural_complexity_0to5  + (1|site.name), data = fish_comb_dat_nmds_levels_algae) 
summary(fish_nmds2_full_mod_algae) #SINGULAR
plot(fish_nmds2_full_mod_algae)
Anova(fish_nmds2_full_mod_algae) #nothing significant***
plot_summs(fish_nmds2_full_mod_algae)




#species richness----
fish_rich_full_mod_sb_level <-lmer(SR~seabird_level  + wind.exposure + structural_complexity_0to5  + (1|site.name), data = fish_comb_dat_nmds_levels_algae) #depth_max_m + start_distance_to_shore_m
summary(fish_rich_full_mod_sb_level)
plot(fish_rich_full_mod_sb_level)
Anova(fish_rich_full_mod_sb_level) #nothing significant***
vif(fish_rich_full_mod_sb_level) #seabird level has high vif

fish_rich_full_mod_algae <-lmer(SR~N.15_at_30m  + wind.exposure + structural_complexity_0to5  + (1|site.name), data = fish_comb_dat_nmds_levels_algae) #depth_max_m + start_distance_to_shore_m
summary(fish_rich_full_mod_algae)
plot(fish_rich_full_mod_algae)
Anova(fish_rich_full_mod_algae) #nothing significant****
plot_summs(fish_rich_full_mod_algae)



#species evenness----
fish_even_full_mod_sb_level <-lmer(evenness~seabird_level  + wind.exposure + structural_complexity_0to5  + (1|site.name), data = fish_comb_dat_nmds_levels_algae) #depth_max_m + start_distance_to_shore_m
summary(fish_even_full_mod_sb_level)
plot(fish_even_full_mod_sb_level)
Anova(fish_even_full_mod_sb_level) #nothing significant***
vif(fish_even_full_mod_sb_level) #seabird level has high vif

fish_even_full_mod_sb_level <-lmer(evenness~N.15_at_30m  + wind.exposure + structural_complexity_0to5  + (1|site.name), data = fish_comb_dat_nmds_levels_algae) #singular
summary(fish_even_full_mod_sb_level)
plot(fish_even_full_mod_sb_level)
Anova(fish_even_full_mod_sb_level) #nothing significant****
plot_summs(fish_even_full_mod_sb_level)



#shannon----
fish_shannon_full_mod_sb_level <-lmer(shannon~seabird_level  + wind.exposure + structural_complexity_0to5  + (1|site.name), data = fish_comb_dat_nmds_levels_algae)  #singular
summary(fish_shannon_full_mod_sb_level)
plot(fish_shannon_full_mod_sb_level)
Anova(fish_shannon_full_mod_sb_level) #nothing significant***
vif(fish_shannon_full_mod_sb_level) #seabird level has high vif

fish_shannon_full_mod_sb_level <-lmer(shannon~N.15_at_30m  + wind.exposure + structural_complexity_0to5  + (1|site.name), data = fish_comb_dat_nmds_levels_algae)   #singular
summary(fish_shannon_full_mod_sb_level)
plot(fish_shannon_full_mod_sb_level)
Anova(fish_shannon_full_mod_sb_level) #nothing significant****
plot_summs(fish_shannon_full_mod_sb_level)


###DOUBLE-CHECK WHICH NMDS THIS COMING FROM - SPECIES OR FEEDING GROUP? I think this is density (log) by diet group--------


#lmms for herbivores and then piscivores - expect most affected from other sites----
fish_herb_full_mod_sb_level <-lmer(Herb_biomass~seabird_level  + wind.exposure + structural_complexity_0to5  + (1|site.name), data = fish_comb_dat_nmds_levels_algae)  
summary(fish_herb_full_mod_sb_level)
plot(fish_herb_full_mod_sb_level)
Anova(fish_herb_full_mod_sb_level) #nothing significant***
vif(fish_herb_full_mod_sb_level) #seabird level has high vif

fish_herb_full_mod_n15 <-lmer(Herb_biomass~N.15_at_30m  + wind.exposure + structural_complexity_0to5  + (1|site.name), data = fish_comb_dat_nmds_levels_algae)   #singular
summary(fish_herb_full_mod_n15)
plot(fish_herb_full_mod_n15)
Anova(fish_herb_full_mod_n15) #nothing significant****
vif(fish_herb_full_mod_n15) #all okay
plot_summs(fish_herb_full_mod_n15)


fish_pisc_full_mod_sb_level <-lmer(FisCep_biomass~seabird_level  + wind.exposure + structural_complexity_0to5  + (1|site.name), data = fish_comb_dat_nmds_levels_algae)  
summary(fish_pisc_full_mod_sb_level)
plot(fish_pisc_full_mod_sb_level)
Anova(fish_pisc_full_mod_sb_level) #nothing significant***
vif(fish_pisc_full_mod_sb_level) #seabird level has high vif

fish_pisc_full_mod_n15 <-lmer(FisCep_biomass~N.15_at_30m  + wind.exposure + structural_complexity_0to5  + (1|site.name), data = fish_comb_dat_nmds_levels_algae)   #singular
summary(fish_pisc_full_mod_n15)
plot(fish_pisc_full_mod_n15)
Anova(fish_pisc_full_mod_n15) #nothing significant****
plot_summs(fish_pisc_full_mod_n15)
vif(fish_pisc_full_mod_n15)

```



#re-extract NMDS scores (feeding group, density) to ensure above lmms correct with NMDS axes:
```{r}
nmds_fish_group_log_dens_site.sc <- scores(nmds_fish_log_dens, display = "sites", shrink = FALSE) 
nmds_fish_group_log_dens_site.sc

#merge site.sc with metadata and dispersion
nmds_fish_group_log_dens_site_scores<-
  bind_cols(fish.dens.seabirds.trans$site.name,
                    as_tibble(nmds_fish_group_log_dens_site.sc))%>%
  rename('site.name' = '...1')%>%
  mutate(transect = c(1,2,3,4, 1,2,3,4, 1,2,3,4, 1,2,3,4, 1,2,3,4, 1,2,3,4))%>%
  mutate(transect = as.factor(transect))
nmds_fish_group_log_dens_site_scores


fish_comb_dat_nmds_levels_algae_nmds<-left_join(fish_comb_dat_nmds_levels_algae, nmds_fish_group_log_dens_site_scores,
                                                by = c("site.name", "transect"))
fish_comb_dat_nmds_levels_algae_nmds
#YUP, NMDS1 and NMDS2 MATCH, SO THIS IS CORRECT DATA***


#check species scores with nmds1:
cor(fish.log.dens.seabirds.trans_sp_log, scores(nmds_fish_log_dens, dis="si"))
#             NMDS1       NMDS2
#Herb    0.06504294  0.22939978
#InvMob  0.23746892  0.06510576
#Omnivr -0.09129313 -0.08406169
#Plktiv -0.82318831 -0.13185462
#FisCep  0.79640924 -0.16916689
#InvSes  0.04645569 -0.98103598
#looks like planktivores have strongest negative correlation, and piscivores have strongest positive correlation....

scores(nmds_fish_log_dens, display="species")
#consistent with above.


##permanova----
#set blocks by atoll
perm <- how(nperm = 999)
setBlocks(perm) <- with(fish_comb_dat_nmds_levels_algae, site.name)

#run analysis
fish_sb_level_ad<-adonis2(fish.log.dens.seabirds.trans_sp_log ~ seabird_level  + wind.exposure + structural_complexity_0to5, data = fish_comb_dat_nmds_levels_algae, permutations = perm)
fish_sb_level_ad
#nothing even close to significant


fish_algaen15_ad<-adonis2(fish.log.dens.seabirds.trans_sp_log ~ N.15_at_30m  + wind.exposure + structural_complexity_0to5, data = fish_comb_dat_nmds_levels_algae, permutations = perm)
fish_algaen15_ad
#nothing even close to significant

#makes sense, because nothing significant even in manova (not based on site blocks)

#re-plot NMDS------
nmds_fish_log_dens_spp.sc <- as.data.frame(scores(nmds_fish_log_dens, "species"))  #Using the scores function from vegan to extract the species scores and convert to a data.frame
nmds_fish_log_dens_spp.sc<-
  nmds_fish_log_dens_spp.sc%>%
  rownames_to_column(var="Species") # create a column of species, from the rownames of species.scores


nmds_fish_log_dens_site.sc <- scores(nmds_fish_log_dens, display = "sites", shrink = FALSE) 
nmds_fish_log_dens_site.sc

#merge site.sc with metadata and dispersion
nmds_fish_log_dens_site_scores<-
  bind_cols(fish.dens.seabirds.trans$site.name,
                    as_tibble(nmds_fish_log_dens_site.sc))%>%
  rename('site.name' = '...1')
nmds_fish_log_dens_site_scores



#get hull data:
site.A1 <- nmds_fish_log_dens_site_scores[nmds_fish_log_dens_site_scores$site.name == "Aie_Exposed", ][chull(nmds_fish_log_dens_site_scores[nmds_fish_log_dens_site_scores$site.name == 
    "Aie_Exposed", c("NMDS1", "NMDS2")]), ]

site.A2 <- nmds_fish_log_dens_site_scores[nmds_fish_log_dens_site_scores$site.name == "Aie_Protected", ][chull(nmds_fish_log_dens_site_scores[nmds_fish_log_dens_site_scores$site.name == 
    "Aie_Protected", c("NMDS1", "NMDS2")]), ]  

site.Re1 <- nmds_fish_log_dens_site_scores[nmds_fish_log_dens_site_scores$site.name == "Reiono_Protected", ][chull(nmds_fish_log_dens_site_scores[nmds_fish_log_dens_site_scores$site.name == 
    "Reiono_Protected", c("NMDS1", "NMDS2")]), ]

site.Re2<- nmds_fish_log_dens_site_scores[nmds_fish_log_dens_site_scores$site.name == "Reiono_Exposed", ][chull(nmds_fish_log_dens_site_scores[nmds_fish_log_dens_site_scores$site.name == 
    "Reiono_Exposed", c("NMDS1", "NMDS2")]), ]  

site.Rm1 <- nmds_fish_log_dens_site_scores[nmds_fish_log_dens_site_scores$site.name == "Rimatuu_Protected", ][chull(nmds_fish_log_dens_site_scores[nmds_fish_log_dens_site_scores$site.name == 
    "Rimatuu_Protected", c("NMDS1", "NMDS2")]), ]

site.Rm2<- nmds_fish_log_dens_site_scores[nmds_fish_log_dens_site_scores$site.name == "Rimatuu_Exposed", ][chull(nmds_fish_log_dens_site_scores[nmds_fish_log_dens_site_scores$site.name == 
    "Rimatuu_Exposed", c("NMDS1", "NMDS2")]), ]  

hull.data <- rbind(site.A1, site.A2, site.Re1, site.Re2, site.Rm1, site.Rm2)  #combine
hull.data

ggplot() + 
  geom_text(data=nmds_fish_log_dens_spp.sc,aes(x=NMDS1,y=NMDS2,label=Species), alpha = .2) +  # add the species labels - 
  geom_point(data=nmds_fish_log_dens_site_scores,aes(x=NMDS1,y=NMDS2,colour=site.name, fill = site.name), stat="identity", size=5, alpha = .9) +
  geom_polygon(data=hull.data,aes(x=NMDS1,y=NMDS2,fill=site.name,group=site.name),alpha=0.30) + # add the convex hulls
  theme_bw() + 
  theme(panel.grid.major = element_blank(), # remove gridlines
        panel.grid.minor = element_blank(), #remove gridlines
        strip.background = element_blank(), #remove gray boxes
        text = element_text(size=20))
        #legend.title = element_blank()) #remove legend title
        #legend.box.background = element_rect(colour = "black", fill='white', linetype='solid', size=1), 
       # legend.justification=c(1,.9), legend.position=c(1,.9))  #  fix legend


#get hull data - seabird level:----
sb.low <- fish_comb_dat_nmds_levels_algae[fish_comb_dat_nmds_levels_algae$seabird_level == "low", ][chull(fish_comb_dat_nmds_levels_algae[fish_comb_dat_nmds_levels_algae$seabird_level == 
    "low", c("NMDS1", "NMDS2")]), ]

sb.mid <- fish_comb_dat_nmds_levels_algae[fish_comb_dat_nmds_levels_algae$seabird_level == "mid", ][chull(fish_comb_dat_nmds_levels_algae[fish_comb_dat_nmds_levels_algae$seabird_level == 
    "mid", c("NMDS1", "NMDS2")]), ]

sb.high <- fish_comb_dat_nmds_levels_algae[fish_comb_dat_nmds_levels_algae$seabird_level == "high", ][chull(fish_comb_dat_nmds_levels_algae[fish_comb_dat_nmds_levels_algae$seabird_level == 
    "high", c("NMDS1", "NMDS2")]), ]


hull.data2 <- rbind(sb.low, sb.mid, sb.high)  #combine
hull.data2

ggplot() + 
  geom_text(data=nmds_fish_log_dens_spp.sc,aes(x=NMDS1,y=NMDS2,label=Species), alpha = .2) +  # add the species labels - 
  geom_point(data=fish_comb_dat_nmds_levels_algae,aes(x=NMDS1,y=NMDS2,colour=seabird_level, fill = seabird_level, pch = seabird_level), stat="identity", size=5, alpha = .9) +
  geom_polygon(data=hull.data2,aes(x=NMDS1,y=NMDS2,fill=seabird_level,group=seabird_level),alpha=0.30) + # add the convex hulls
  theme_bw() + 
  theme(panel.grid.major = element_blank(), # remove gridlines
        panel.grid.minor = element_blank(), #remove gridlines
        strip.background = element_blank()) #remove gray boxes
        #legend.title = element_blank()) #remove legend title
        #legend.box.background = element_rect(colour = "black", fill='white', linetype='solid', size=1), 
       # legend.justification=c(1,.9), legend.position=c(1,.9))  #  fix legend

##add arrows----
ord.fit<-envfit(nmds_fish_log_dens~N.15_at_30m + wind.exposure + structural_complexity_0to5+ seabird_level, data = fish_comb_dat_nmds_levels_algae, na.rm=TRUE)
ord.fit #looks like N15 at 30 is significant

sb.scrs <- as.data.frame(scores(ord.fit, display = "vectors"))
sb.scrs <- cbind(sb.scrs, variable = rownames(sb.scrs))
sb.scrs<-
  sb.scrs%>%
  mutate(variable2 = c("algae n15", "structural complexity"))

sb.scrs2 <- as.data.frame(scores(ord.fit, display = "factors"))
sb.scrs2 <- cbind(sb.scrs2, Factor = rownames(sb.scrs2))
sb.scrs2


nmds_fish_log_dens_spp.sc<-
  nmds_fish_log_dens_spp.sc%>%
  mutate(species2 = c("Herbivore", "Mobile Invertebrate Feeder", "Omnivore", "Planktivore", "Piscivore", "Sessile Invertebrate Feeder"))

fish_dens_log_nmds_plot2<-
ggplot() + 
  geom_text(data=nmds_fish_log_dens_spp.sc,aes(x=NMDS1,y=NMDS2,label=species2), alpha = .7, size = 3, hjust = .1) +  # add the species labels - 
  #  geom_point(data=nmds_fish_log_dens_spp.sc,aes(x=NMDS1,y=NMDS2,pch=species2), alpha = .7) +  # add the species labels - 
  geom_point(data=fish_comb_dat_nmds_levels_algae,aes(x=NMDS1,y=NMDS2,colour=seabird_level, fill = seabird_level, pch = seabird_level), stat="identity", size=5, alpha = .9) +
  geom_polygon(data=hull.data2,aes(x=NMDS1,y=NMDS2,fill=seabird_level,group=seabird_level),alpha=0.30) + # add the convex hulls
    coord_fixed() + ## need aspect ratio of 1!
  geom_segment(data = sb.scrs,
               aes(x = 0, xend = NMDS1, y = 0, yend = NMDS2),
               arrow = arrow(length = unit(0.25, "cm")), alpha = .5) +
    geom_text(data = sb.scrs, aes(x = NMDS1, y = NMDS2, label = sb.scrs$variable2),
            size = 3, vjust = c(-1,2), hjust = c(.9, .5), alpha = .5)+
   #   geom_text(data = sb.scrs2, aes(x = NMDS1, y = NMDS2, label = sb.scrs2$Factor),
     #       size = 3)+
  theme_bw() + 
  theme(panel.grid.major = element_blank(), # remove gridlines
        panel.grid.minor = element_blank(), #remove gridlines
        strip.background = element_blank(),
        legend.position = c(.2, .9)) #remove gray boxes

fish_dens_log_nmds_plot2


#save plot
#ggsave(fish_dens_log_nmds_plot2, file = "../output/seabird-fish/fish_dens_log_nmds_plot2.jpg",
#       width = 7, height = 5)


```

#plot nmds 1 versus n15 (and seabird level) using raw data and emmeans
```{r}

fish_nmds1_full_mod_algae <-lmer(NMDS1~N.15_at_30m  + wind.exposure + structural_complexity_0to5  + (1|site.name), data = fish_comb_dat_nmds_levels_algae) #depth_max_m + start_distance_to_shore_m

emmip(fish_nmds1_full_mod_algae,  ~ N.15_at_30m, at = mylist, CIs = TRUE)


#plot raw data + lines: 

em1 <- ref_grid(fish_nmds1_full_mod_algae, at = list(N.15_at_30m = seq(min(fish_comb_dat_nmds_levels_algae$N.15_at_30m), max(fish_comb_dat_nmds_levels_algae$N.15_at_30m), .01))) 
d1 <- emmip(em1, ~N.15_at_30m, CIs = T, plotit = F)
d1
emmip(em1, ~N.15_at_30m, CIs = T) 


fish_nmds1_est_plot<-
fish_comb_dat_nmds_levels_algae %>%
   ggplot(aes(x = N.15_at_30m, y = NMDS1))+
geom_line(data = d1, aes(x = N.15_at_30m, y = yvar))+
     geom_ribbon(data = d1, aes(x = N.15_at_30m, y = yvar, ymin = LCL, ymax=UCL), alpha = .1, lwd=0)+
    geom_point(aes(color = seabird_level, fill = seabird_level), alpha = .5, size = 3)+ #, shape = motu
    ylab("Fish NMDS1")+
  xlab("Algae N15")+
  theme_bw() +
  theme(panel.grid.major = element_blank(), # remove gridlines
        panel.grid.minor = element_blank(), #remove gridlines
        strip.background = element_blank(),
        legend.position = c(.25,.9),
        legend.direction = "horizontal",
        legend.box.background = element_rect(colour = "black"))


fish_nmds1_est_plot

#ggsave(fish_nmds1_est_plot, file = "../output/seabird-fish/fish_nmds1_est_plot.jpg",
    #   width = 7, height = 5)

```



#more plots
```{r}

#fish biomass-----
fish_comb_dat_nmds_levels_algae%>%
group_by(seabird_level)%>%
  summarize(mean_bio = mean(sum_fish_biomass),
            n_bio5 = length(sum_fish_biomass),
            se_bio = sd(sum_fish_biomass)/sqrt(n_bio5))%>%
  ggplot(aes(x = seabird_level, y = mean_bio, color = seabird_level, fill = seabird_level, group = seabird_level))+
  geom_point(alpha = .5)+
  geom_errorbar(aes(ymin = (mean_bio-se_bio), ymax = (mean_bio+se_bio)), alpha = .5, width = 0)+
  geom_line(alpha = .5)+
  theme_bw() 


fish_comb_dat_nmds_levels_algae%>%
  ggplot(aes(x = N.15_at_30m, y = sum_fish_biomass))+
  geom_point(alpha = .5)+
geom_smooth(method = "lm")+
  theme_bw() 


emmip(fish_bio_full_mod_sb_level, ~ seabird_level,
          type = "response", CIs = TRUE)
#actually doesn't make much sense, maybe should use log*****



#richness
emmip(fish_rich_full_mod_sb_level, ~ seabird_level,
          type = "response", CIs = TRUE)


#nmds1
emmip(fish_nmds1_full_mod_sb_level, ~ seabird_level,
          type = "response", CIs = TRUE)

emmip(fish_nmds1_full_mod_algae, ~ N.15_at_30m , at = list(N.15_at_30m = c(3,4,5,6,7)),
          type = "response", CIs = TRUE)



```




####stacked bar plot by seabird levels----
```{r}
##stacked bar plot by seabird levels----
fish_fg_bio_stack_barplot_seabird_level<-
fish_comb_dat_nmds_levels_algae%>%
  pivot_longer(cols = c(Herb_biomass:InvSes_biomass),
                                          names_to = "feeding_group",
                                          values_to = "biomass_kg_ha")%>%
  group_by(feeding_group, seabird_level)%>%
  summarize(mean_biomass = mean(biomass_kg_ha))%>%
  mutate(feeding_group = as.factor(feeding_group))%>%
#  mutate(feeding_group = fct_relevel(feeding_group, c("Herb", "Omnivr", "Plktiv", "InvSes", "InvMob", "FisCep")))%>%
  ggplot(aes(fill = feeding_group, y = mean_biomass, x = seabird_level))+
  geom_bar(position = "stack", stat =  "identity")+
  scale_fill_brewer(palette = "Set2")+
  xlab("")+
  ylab("mean biomass (kg/ha)")+
    theme_bw()+
  theme(panel.grid.major = element_blank(), # remove gridlines
        panel.grid.minor = element_blank(), #remove gridlines
        strip.background = element_blank(),
        axis.text.x = element_text(angle = 45, hjust = 1)
        )
  
fish_fg_bio_stack_barplot_seabird_level


fish_fg_bio_stack_barplot_structure<-
fish_comb_dat_nmds_levels_algae%>%
  pivot_longer(cols = c(Herb_biomass:InvSes_biomass),
                                          names_to = "feeding_group",
                                          values_to = "biomass_kg_ha")%>%
  group_by(feeding_group, structural_complexity_0to5)%>%
  summarize(mean_biomass = mean(biomass_kg_ha))%>%
  mutate(feeding_group = as.factor(feeding_group))%>%
#  mutate(feeding_group = fct_relevel(feeding_group, c("Herb", "Omnivr", "Plktiv", "InvSes", "InvMob", "FisCep")))%>%
  ggplot(aes(fill = feeding_group, y = mean_biomass, x = structural_complexity_0to5))+
  geom_bar(position = "stack", stat =  "identity")+
  scale_fill_brewer(palette = "Set2")+
  xlab("")+
  ylab("mean biomass (kg/ha)")+
    theme_bw()+
  theme(panel.grid.major = element_blank(), # remove gridlines
        panel.grid.minor = element_blank(), #remove gridlines
        strip.background = element_blank(),
        axis.text.x = element_text(angle = 45, hjust = 1)
        )

fish_fg_bio_stack_barplot_structure

  
###raw data looks weird because structure + seabirds negatively correlated --- don't really want to show this without accounting for other variables.---=--


```


###add in hard coral cover as model co-variate-----
```{r}
##video----
benthic.vid.seabirds.levels.algae #from seabird_vs_benthos
fish_comb_dat_nmds_levels_algae_coral<-
  left_join(fish_comb_dat_nmds_levels_algae, select(benthic.vid.seabirds.levels.algae, c("site.name", "transect", "hard_coral_percent_cover")),
                                                    by = c("site.name", "transect"))

fish_comb_dat_nmds_levels_algae_coral

#total biomass----
fish_bio_full_mod_sb_level_coral <-lmer(sum_fish_biomass~seabird_level  + wind.exposure + structural_complexity_0to5  + hard_coral_percent_cover + (1|site.name), data = fish_comb_dat_nmds_levels_algae_coral) #depth_max_m + start_distance_to_shore_m
summary(fish_bio_full_mod_sb_level_coral) ##SINGULAR
plot(fish_bio_full_mod_sb_level_coral)
Anova(fish_bio_full_mod_sb_level_coral) #now seabird level and hard coral both marginal
plot_summs(fish_bio_full_mod_sb_level_coral)
vif(fish_bio_full_mod_sb_level_coral) #oh, seabird level may have high GVIF


#try with log:
fish_bio_full_mod_sb_level_log_coral <-lmer(log(sum_fish_biomass+1)~seabird_level  + wind.exposure + structural_complexity_0to5  + + hard_coral_percent_cover + (1|site.name), data = fish_comb_dat_nmds_levels_algae_coral) #depth_max_m + start_distance_to_shore_m
summary(fish_bio_full_mod_sb_level_log_coral) #phew, not singular here*
plot(fish_bio_full_mod_sb_level_log_coral)
Anova(fish_bio_full_mod_sb_level_log_coral) #nothing significant***




##situ----
benthic.situ.seabirds.levels.algae #from seabird_vs_benthos
fish_comb_dat_nmds_levels_algae_coral_situ<-
  left_join(fish_comb_dat_nmds_levels_algae, select(benthic.situ.seabirds.levels.algae, c("site.name", "transect", "coral_prop_cover")),
                                                    by = c("site.name", "transect"))

fish_comb_dat_nmds_levels_algae_coral_situ

#total biomass----
fish_bio_full_mod_sb_level_coral_situ <-lmer(sum_fish_biomass~seabird_level  + wind.exposure + structural_complexity_0to5  + coral_prop_cover + (1|site.name), data = fish_comb_dat_nmds_levels_algae_coral_situ) #depth_max_m + start_distance_to_shore_m
summary(fish_bio_full_mod_sb_level_coral) ##SINGULAR
plot(fish_bio_full_mod_sb_level_coral_situ)
Anova(fish_bio_full_mod_sb_level_coral_situ) #now seabird level and hard coral both marginal
plot_summs(fish_bio_full_mod_sb_level_coral_situ)
vif(fish_bio_full_mod_sb_level_coral_situ) #oh, seabird level may have high GVIF


#try with log:
fish_bio_full_mod_sb_level_log_coral_situ <-lmer(log(sum_fish_biomass+1)~seabird_level  + wind.exposure + structural_complexity_0to5  + coral_prop_cover + (1|site.name), data = fish_comb_dat_nmds_levels_algae_coral_situ) #depth_max_m + start_distance_to_shore_m
summary(fish_bio_full_mod_sb_level_log_coral_situ) #phew, not singular here*
plot(fish_bio_full_mod_sb_level_log_coral_situ)
plot_summs(fish_bio_full_mod_sb_level_log_coral_situ)
Anova(fish_bio_full_mod_sb_level_log_coral_situ) #nothing significant***



##okay looks like not worth it to try and include coral cover, doesn't add anything------

```

