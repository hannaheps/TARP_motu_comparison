#Reiono exposed = 115.353333
#Rimatuu protected = 5.390526
fishn15.seabirds.cond<-
fishn15.seabirds.cond%>%
mutate(seabird_level = case_when(breeding_biomass_kgha_side<10 ~"low",
breeding_biomass_kgha_side>10&breeding_biomass_kgha_side <200 ~"mid",
breeding_biomass_kgha_side>200 ~"high"))%>%
mutate(seabird_level = as.factor(seabird_level))%>%
mutate(seabird_level = fct_relevel(seabird_level, "low", "mid", "high"))%>%
relocate(seabird_level, .before = breeding_biomass_kgha_side)
fishn15.seabirds.cond
##remove C. argus because n = 1 for 'high' (Aie)----
fishn15.seabirds.cond.r<-
fishn15.seabirds.cond%>%
filter(species != "Cephalopholis argus")%>%
droplevels()
##check sample sizes, lengths per site:----
fishn15.seabirds.cond.r%>%
group_by(species, site.name)%>%
summarize(n = length(n15))
#n15----
fish_n15_lm<-lm(n15~ seabird_level*species,
data = fishn15.seabirds.cond)
summary(fish_n15_lm)
anova(fish_n15_lm)#everything significant
plot(fish_n15_lm) #qq not great, and one point (10) with extremely high leverage = Aie C. argus because n = 1 for this***
#re-run without argus, n15---
fish_n15_r_lm<-lm(n15~ seabird_level*species,
data = fishn15.seabirds.cond.r)
summary(fish_n15_r_lm)
anova(fish_n15_r_lm) #everything significant
plot(fish_n15_r_lm) #qq not great
fish_n15_r_log_lm<-lm(log(n15)~ seabird_level*species,
data = fishn15.seabirds.cond.r)
summary(fish_n15_r_log_lm)
anova(fish_n15_r_log_lm) #everything significant
plot(fish_n15_r_log_lm) #qq still not great. proceed with non-log for now....
#look at emmeans:
fish_n15_r_lm %>%
emmeans(~ seabird_level|species,
type = "response")
EMM_fish_n15 <- emmeans(fish_n15_r_lm, ~ species * seabird_level)
pairs(EMM_fish_n15, simple = "seabird_level", type = "response")
#Ab sept - mid and high are both higher than low, but not different from each other***
#A tri - low is lower than mid, and mid is marginally higher than high. low and high not different
#Lutjanus - nothing significant
#Stegastes nigricans - low is marginally lower than mid, all else not difference.
test(pairs(EMM_fish_n15, by = "species"), by = NULL, adjust = "mvt")
test(pairs(EMM_fish_n15, by = "species"), by = NULL, adjust = "none")
#similar to pairs results above
emmeans(EMM_fish_n15, list(pairwise ~ seabird_level|species), adjust = "fdr")
emmeans(fish_n15_r_lm, list(pairwise ~ seabird_level|species), adjust = "fdr")
#same results
emmeans(EMM_fish_n15, list(pairwise ~ seabird_level|species), adjust = "fdr")
emmeans(fish_n15_r_log_lm, list(pairwise ~ seabird_level|species), adjust = "fdr")
emmeans(fish_n15_r_log_lm, list(pairwise ~ seabird_level|species), adjust = "fdr", type = "response")
emmeans(fish_n15_r_log_lm, list(revpairwise ~ seabird_level|species), adjust = "fdr", type = "response")
emmeans(fish_n15_r_log_lm, list(pairwise ~ seabird_level|species), adjust = "fdr", type = "response")
library(tidyverse)
library(lme4)
library(car)
library(jtools)
library(emmeans)
library(corrplot)
seabirds <- read.csv("../output/n15_seabirds_combined_no_iti.csv", strip.white = T, header = T)
fish_n15_cond <- read.csv("../../fish_isotopes/output/fish_n15_condition.csv", stringsAsFactors = TRUE)
algae_n15<-read.csv("../output/n15_seabirds_combined_no_iti.csv")
#make combined site name column in fish_n15
fishn15.seabirds.cond<-right_join(dplyr::select(seabirds, c("site.name", "breeding_biomass_kgha_side")),
dplyr::select(fish_n15_cond, c("site.name", "motu", "fish.id", "species",
"month.caught", "year.caught", "protection", "TL.cm", "FL.cm", "SL.cm", "whole.weight.g",
"liver.weight.g", "n15", "c13", "n.percent", "c.percent")),
by = "site.name")%>%
mutate(site.name = as.factor(site.name))
fishn15.seabirds.cond
#add k and hsi----
fishn15.seabirds.cond<-
fishn15.seabirds.cond%>%
mutate(K = 100*(whole.weight.g/(TL.cm^3)),
HSI = liver.weight.g/whole.weight.g*100)
fishn15.seabirds.cond
#3 sites, add seabird levels because non-linear possible and only 3 sites so needs to be categorical:----
#Aie protected = 378.720000
#Reiono exposed = 115.353333
#Rimatuu protected = 5.390526
fishn15.seabirds.cond<-
fishn15.seabirds.cond%>%
mutate(seabird_level = case_when(breeding_biomass_kgha_side<10 ~"low",
breeding_biomass_kgha_side>10&breeding_biomass_kgha_side <200 ~"mid",
breeding_biomass_kgha_side>200 ~"high"))%>%
mutate(seabird_level = as.factor(seabird_level))%>%
mutate(seabird_level = fct_relevel(seabird_level, "low", "mid", "high"))%>%
relocate(seabird_level, .before = breeding_biomass_kgha_side)
fishn15.seabirds.cond
##remove C. argus because n = 1 for 'high' (Aie)----
fishn15.seabirds.cond.r<-
fishn15.seabirds.cond%>%
filter(species != "Cephalopholis argus")%>%
droplevels()
##check sample sizes, lengths per site:----
fishn15.seabirds.cond.r%>%
group_by(species, site.name)%>%
summarize(n = length(n15))
#combine data with algae n15----
fishn15.seabirds.cond.algae<-
left_join(fishn15.seabirds.cond.r,
select(algae_n15, c("site.name", "N.15_at_10m", "N.15_at_20m","N.15_at_30m","N.15_at_40m")),
by = "site.name")
fishn15.seabirds.cond.algae
#n15----
fish_n15_algae_lm<-lm(n15~ N.15_at_40m*species,
data = fishn15.seabirds.cond.algae)
summary(fish_n15_algae_lm)
anova(fish_n15_algae_lm)#everything significant
plot(fish_n15_algae_lm) #okay
#look at emmeans:
emtrends(fish_n15_algae_lm,  ~ species, var = "N.15_at_40m")
#looks like Ab sept and Ac tri both are positive. Other two trending towards positive but overlaps 0
test(emtrends(fish_n15_algae_lm, ~ species, var = "N.15_at_40m", adjust = "fdr"))
test(emtrends(fish_n15_algae_lm, ~ species, var = "N.15_at_40m", adjust = "none"))
#try with lmer:
fish_n15_algae_lmer<-lmer(n15~ N.15_at_40m*species + (1|site.name),
data = fishn15.seabirds.cond.algae)
summary(fish_n15_algae_lmer)
Anova(fish_n15_algae_lmer)
test(emtrends(fish_n15_algae_lmer, ~ species, var = "N.15_at_40m", adjust = "fdr"))
emtrends(fish_n15_algae_lmer, ~ species, var = "N.15_at_40m")
fish_n15_algae_lmer.add<-lmer(n15~ N.15_at_40m+species + (1|site.name),
data = fishn15.seabirds.cond.algae)
summary(fish_n15_algae_lmer.add)
Anova(fish_n15_algae_lmer.add)
# plot - maybe just for supplement---------
range(fishn15.seabirds.cond.algae$N.15_at_40m) #3.043333 6.003333
levels(fishn15.seabirds.cond.algae$species)
(mylist <- list(
N.15_at_40m = seq(3, 6, by = 1),
species = c("Abudefduf septemfasciatus", "Acanthurus triostegus" ,   "Lutjanus fulvus"     ,
"Stegastes nigricans")
))
emmip(fish_n15_algae_lm, species ~ N.15_at_40m, at = mylist, CIs = TRUE)
#plot raw data + lines:
plot_dat<-emmip(fish_n15_algae_lm, species ~ N.15_at_40m, at = mylist, CIs = TRUE, plotit=FALSE)
plot_dat
fishn15.seabirds.cond.algae %>%
ggplot(aes(x = N.15_at_40m, y = n15, color = species, fill = species, group = species))+
geom_point(alpha = .5)+
geom_line(data = plot_dat, aes(x = N.15_at_40m, y = yvar, color = species, group = species))+
theme_bw()
(mylist2 <- list(
N.15_at_40m = c(3.043333, 5.233333, 6.003333),
species = c("Abudefduf septemfasciatus", "Acanthurus triostegus" ,   "Lutjanus fulvus"     ,
"Stegastes nigricans")
))
plot_dat2<-emmip(fish_n15_algae_lm, species ~ N.15_at_40m, at = mylist2, CIs = TRUE, plotit=FALSE)
plot_dat2
fishn15.seabirds.cond.algae %>%
mutate(species = fct_relevel(species, c("Acanthurus triostegus", "Stegastes nigricans", "Abudefduf septemfasciatus", "Lutjanus fulvus")))%>%
ggplot(aes(x = N.15_at_40m, y = n15, color = species, fill = species, group = species))+
geom_point(alpha = .5)+
geom_ribbon(data = plot_dat2, aes(x = N.15_at_40m, y = yvar, ymin = LCL, ymax=UCL, fill = species), alpha = .2, lwd=0)+
geom_line(data = plot_dat2, aes(x = N.15_at_40m, y = yvar, color = species, group = species))+
theme_bw()
fishn15.algan15.plot<-
fishn15.seabirds.cond.algae %>%
mutate(species = fct_relevel(species, c("Acanthurus triostegus", "Stegastes nigricans", "Abudefduf septemfasciatus", "Lutjanus fulvus")))%>%
ggplot(aes(x = N.15_at_40m, y = n15, color = species, fill = species, group = species))+
geom_point(alpha = .8)+
geom_ribbon(data = plot_dat2, aes(x = N.15_at_40m, y = yvar, ymin = LCL, ymax=UCL, fill = species), alpha = .2, lwd=0)+
geom_line(data = plot_dat2, aes(x = N.15_at_40m, y = yvar, color = species, group = species))+
ylab(expression(Fish~delta^15~N))+
xlab(expression(Algae~delta^15~N))+
labs(color = "", fill = "")+
theme_bw() +
theme(panel.grid.major = element_blank(), # remove gridlines
panel.grid.minor = element_blank(), #remove gridlines
strip.background = element_blank(),
legend.position = c(.2,.85),
legend.background = element_blank())
#legent.key = element_rect) #,
#legend.direction = "horizontal",
#  legend.box.background = element_rect(colour = "black"))
fishn15.algan15.plot
#ggsave("../output/seabird-fishn15/fish_n15_algae_n15_estplot_lines_points.jpg", plot = fishn15.algan15.plot, width = 7, height = 5)
#just raw data:
fishn15.seabirds.cond.algae %>%
ggplot(aes(x = N.15_at_40m, y = n15, color = species, fill = species, group = species))+
geom_point(alpha = .5)+
stat_smooth(method = "lm")+
theme_bw()
fishn15.seabirds.cond.algae%>%
group_by(species, N.15_at_40m)%>%
summarize(mean_n15 = mean(n15),
n_n15 = length(n15),
se_n15 = sd(n15)/sqrt(n_n15))%>%
ggplot(aes(x = N.15_at_40m, y = mean_n15, color = species, fill = species, group = species))+
geom_point(alpha = .5)+
geom_errorbar(aes(ymin = (mean_n15-se_n15), ymax = (mean_n15+se_n15)), alpha = .5, width = 0)+
geom_line(alpha = .5)+
theme_bw()
#add quadratic:0----
fish_n15_algae_lm_quad<-lm(n15~ N.15_at_40m*species + I(N.15_at_40m^2)*species,
data = fishn15.seabirds.cond.algae)
summary(fish_n15_algae_lm_quad)
summary(fish_n15_algae_lm_quad)
anova(fish_n15_algae_lm_quad)#everything significant, except poly2*species
plot(fish_n15_algae_lm_quad) #okay
test(emtrends(fish_n15_algae_lm_quad, ~ species, var = "N.15_at_40m", adjust = "fdr"))
test(emtrends(fish_n15_algae_lm_quad, ~ species, var = "I(N.15_at_40m^2)", adjust = "fdr"))
test(emtrends(fish_n15_algae_lm_quad, ~ species, var = "N.15_at_40m", adjust = "fdr", max.degree=2))
fish_n15_algae_lm_quad2<-lm(n15~ N.15_at_40m*species + poly(N.15_at_40m,2)*species,
data = fishn15.seabirds.cond.algae)
summary(fish_n15_algae_lm_quad2)
test(emtrends(fish_n15_algae_lm_quad2, ~ species, var = "N.15_at_40m", adjust = "fdr", max.degree=2))
(mylist2 <- list(
N.15_at_40m = c(3.043333, 5.233333, 6.003333),
species = c("Abudefduf septemfasciatus", "Acanthurus triostegus" ,   "Lutjanus fulvus"     ,
"Stegastes nigricans")
))
emmip(fish_n15_algae_lm_quad2, species ~ N.15_at_40m,  at = mylist2, CIs = TRUE, plotit=TRUE)
plot_dat2<-emmip(fish_n15_algae_lm_quad2, species ~ N.15_at_40m, at = mylist2, CIs = TRUE, plotit=FALSE)
plot_dat2
fishn15.seabirds.cond.algae %>%
mutate(species = fct_relevel(species, c("Acanthurus triostegus", "Stegastes nigricans", "Abudefduf septemfasciatus", "Lutjanus fulvus")))%>%
ggplot(aes(x = N.15_at_40m, y = n15, color = species, fill = species, group = species))+
geom_point(alpha = .5)+
geom_ribbon(data = plot_dat2, aes(x = N.15_at_40m, y = yvar, ymin = LCL, ymax=UCL, fill = species), alpha = .2, lwd=0)+
geom_line(data = plot_dat2, aes(x = N.15_at_40m, y = yvar, color = species, group = species))+
theme_bw()
(mylist3 <- list(
N.15_at_40m = seq(3,6,.1),
species = c("Abudefduf septemfasciatus", "Acanthurus triostegus" ,   "Lutjanus fulvus"     ,
"Stegastes nigricans")
))
plot_dat3<-emmip(fish_n15_algae_lm_quad2, species ~ N.15_at_40m, at = mylist3, CIs = TRUE, plotit=FALSE)
plot_dat3
fishn15.seabirds.cond.algae %>%
mutate(species = fct_relevel(species, c("Acanthurus triostegus", "Stegastes nigricans", "Abudefduf septemfasciatus", "Lutjanus fulvus")))%>%
ggplot(aes(x = N.15_at_40m, y = n15, color = species, fill = species, group = species))+
geom_point(alpha = .5)+
geom_ribbon(data = plot_dat3, aes(x = N.15_at_40m, y = yvar, ymin = LCL, ymax=UCL, fill = species), alpha = .2, lwd=0)+
geom_line(data = plot_dat3, aes(x = N.15_at_40m, y = yvar, color = species, group = species))+
theme_bw()
fish_n15_algae_lm_poly <- lm(n15 ~ poly(N.15_at_40m, degree = 2)*species, data = fishn15.seabirds.cond.algae)
summary(fish_n15_algae_lm_poly)
anova(fish_n15_algae_lm_poly)
anova(fish_n15_algae_lm_quad2)
test(emtrends(fish_n15_algae_lm_poly, ~ species, var = "N.15_at_40m", adjust = "fdr", max.degree=2))
em_means<-emmeans(fish_n15_algae_lm, pairwise ~  N.15_at_40m|species)
contrast(emtrends(fish_n15_algae_lm, ~ species, var = "N.15_at_40m"), "poly")
contrast(em_means[[1]], "poly")
test(emtrends(fish_n15_algae_lm, ~ species, var = "N.15_at_40m"), interaction = c("poly", "species"))
emmip(fish_n15_algae_lm_poly, ~ N.15_at_40m*species, plotit = TRUE)
fishn15.seabirds.cond.algae %>%
mutate(species = fct_relevel(species, c("Acanthurus triostegus", "Stegastes nigricans", "Abudefduf septemfasciatus", "Lutjanus fulvus")))%>%
ggplot(aes(x = N.15_at_40m, y = n15, color = species, fill = species, group = species))+
geom_point(alpha = .5)+
geom_ribbon(data = plot_dat3, aes(x = N.15_at_40m, y = yvar, ymin = LCL, ymax=UCL, fill = species), alpha = .2, lwd=0)+
geom_line(data = plot_dat3, aes(x = N.15_at_40m, y = yvar, color = species, group = species))+
theme_bw()
fish_n15_algae_lm_factor<-lm(n15~ as.factor(N.15_at_40m)*species,
data = fishn15.seabirds.cond.algae)
summary(fish_n15_algae_lm_factor)
anova(fish_n15_algae_lm_factor)#everything significant
Anova(fish_n15_algae_lm_factor)
plot(fish_n15_algae_lm_factor)
#look at emmeans:
fish_n15_algae_lm_factor %>%
emmeans(~ N.15_at_40m|species,
type = "response")
EMM_fish_n15 <- emmeans(fish_n15_algae_lm_factor, ~ species * N.15_at_40m)
pairs(EMM_fish_n15, simple = "N.15_at_40m", type = "response")
emmeans(fish_n15_algae_lm_factor, list(pairwise ~ N.15_at_40m|species), adjust = "fdr")
library(tidyverse)
library(lme4)
library(car)
library(jtools)
library(emmeans)
library(corrplot)
library(vegan)
library(cowplot)
seabirds <- read.csv("../output/n15_seabirds_combined_no_iti.csv", strip.white = T, header = T)
load("../../fish_benthic_surveys/output/data/fish_community_data.Rdata")
fish_bio_dat<-nmds_fish_diet_log_bio_site_scores
fish_bio_dat
#make combined site name column in fish data
fish_bio_dat2<-
fish_bio_dat%>%
mutate(protection = if_else(wind.exposure == "leeward", "Protected", "Exposed"))%>%
relocate(protection, .before = wind.exposure)%>%
mutate(motu = str_to_title(motu))%>%
unite("site.name", c(motu, protection), sep = "_", remove = FALSE)
fish_bio_dat2
fish.bio.seabirds<-left_join(fish_bio_dat2,
select(seabirds, c("site.name", "breeding_biomass_kgha_side")),
by = "site.name")%>%
mutate(site.name = as.factor(site.name))
fish.bio.seabirds
#load data-----
tet_trans_meta<-read.csv("../../metadata/fish_benthic_focal_transect_metadata.csv", stringsAsFactors = TRUE)
str(tet_trans_meta)
#make site name to do easy merge:----
tet_trans_meta2<-
tet_trans_meta%>%
rename_all(str_to_lower)%>%
mutate(protection = if_else(exposure == "Leeward", "Protected", "Exposed"))%>%
relocate(protection, .before = exposure)%>%
mutate(motu = str_to_title(motu))%>%
unite("site.name", c(motu, protection), sep = "_", remove = FALSE)
tet_trans_meta2
fish.bio.seabirds.trans<-right_join(select(tet_trans_meta2, c("site.name", "transect", "start_distance_to_shore_m",
"end_distance_to_shore_m", "depth_min_m", "depth_max_m", "structural_complexity_0to5",
"transect.location")),
fish.bio.seabirds,
by = c("site.name", "transect"))%>%
relocate(breeding_biomass_kgha_side, .after = rat.eradication.status) %>%
mutate(transect.in.out = case_when(grepl(pattern = "off", x = transect.location) ~ "offshore",
grepl(pattern = "in", x = transect.location) ~ "inshore"))%>%
mutate(transect.in.out = as.factor(transect.in.out))%>%
relocate(transect.in.out, .after = transect.location)
fish.bio.seabirds.trans
###add transect data to fish density----
#density by feeding group/diet:
fish_fg_dens_dat<-
nmds_fish_diet_log_site_scores%>%
select(c(motu, site.name, wind.exposure, transect, Herb, InvMob, Omnivr, Plktiv, FisCep, InvSes))%>%
rename_with(~paste0(.,"_density"), Herb:InvSes)%>%
mutate(protection = if_else(wind.exposure == "leeward", "Protected", "Exposed"))%>%
relocate(protection, .before = wind.exposure)%>%
mutate(motu = str_to_title(motu))%>%
unite("site.name", c(motu, protection), sep = "_", remove = FALSE)
fish_fg_dens_dat
fish.dens.seabirds<-left_join(fish_fg_dens_dat,
select(seabirds, c("site.name", "breeding_biomass_kgha_side")),
by = "site.name")%>%
mutate(site.name = as.factor(site.name))
fish.dens.seabirds
#and combine with transect metadata
fish.dens.seabirds.trans<-right_join(select(tet_trans_meta2, c("site.name", "transect", "start_distance_to_shore_m",
"end_distance_to_shore_m", "depth_min_m", "depth_max_m", "structural_complexity_0to5",
"transect.location")),
fish.dens.seabirds,
by = c("site.name", "transect"))%>%
relocate(breeding_biomass_kgha_side, .after = wind.exposure) %>%
mutate(transect.in.out = case_when(grepl(pattern = "off", x = transect.location) ~ "offshore",
grepl(pattern = "in", x = transect.location) ~ "inshore"))%>%
mutate(transect.in.out = as.factor(transect.in.out))%>%
relocate(transect.in.out, .after = transect.location)
fish.dens.seabirds.trans
tet_fish_dens_div_comm_dat
tet_fish_div_comm_tl_dat
nmds_fish_diet_log_site_scores
nmds_fish_diet_log_bio_site_scores
#total density, and diversity stats based on density:
fish_dens_div_dat<-
tet_fish_dens_div_comm_dat%>%
select(c(motu, site.name, wind.exposure, transect, shannon, evenness, sum_dens, PD, SR))%>%
mutate(protection = if_else(wind.exposure == "leeward", "Protected", "Exposed"))%>%
relocate(protection, .before = wind.exposure)%>%
mutate(motu = str_to_title(motu))%>%
unite("site.name", c(motu, protection), sep = "_", remove = FALSE)
#relative biomass by trophic level:
fish_tl_bio_dat<-
tet_fish_div_comm_tl_dat%>%
select(c(motu, site.name, wind.exposure, transect, rel_bio_TL1, rel_bio_TL2, rel_bio_TL3, rel_bio_TL4, rel_bio_TL5))%>%
mutate(protection = if_else(wind.exposure == "leeward", "Protected", "Exposed"))%>%
relocate(protection, .before = wind.exposure)%>%
mutate(motu = str_to_title(motu))%>%
unite("site.name", c(motu, protection), sep = "_", remove = FALSE)
#biomass by feeding group/diet, and keep in metadata from above:
fish_fg_bio_dat<-
fish.bio.seabirds.trans%>%
select(c(motu, site.name,wind.exposure, transect, start_distance_to_shore_m, end_distance_to_shore_m,
depth_min_m, depth_max_m, structural_complexity_0to5, transect.in.out, breeding_biomass_kgha_side,
Herb, InvMob, Omnivr, Plktiv, FisCep, InvSes))%>%
rename_with(~paste0(.,"_biomass"), Herb:InvSes)%>%
rowwise%>%
mutate(sum_fish_biomass = sum(c_across(Herb_biomass:InvSes_biomass)))%>%
ungroup
fish_fg_bio_dat
#now combine----
fish_comb_dat_1<- full_join(fish_dens_div_dat, fish_tl_bio_dat, by = c("motu", "site.name", "wind.exposure", "protection", "transect"))
fish_comb_dat_1
fish_comb_dat_2<- full_join(fish_comb_dat_1, fish_fg_dens_dat, by = c("motu", "site.name", "wind.exposure", "protection", "transect"))
fish_comb_dat_2
fish_comb_dat<- full_join(fish_fg_bio_dat, select(fish_comb_dat_2,-protection), by = c("motu", "site.name", "wind.exposure",  "transect"))
fish_comb_dat
#to seabird biomass----
#seabird levels----
fish_comb_dat_levels<-
fish_comb_dat%>%
mutate(seabird_level = case_when(breeding_biomass_kgha_side<10 ~"low",
breeding_biomass_kgha_side>10&breeding_biomass_kgha_side <200 ~"mid",
breeding_biomass_kgha_side>200 ~"high"))%>%
mutate(seabird_level = as.factor(seabird_level))%>%
mutate(seabird_level = fct_relevel(seabird_level, "low", "mid", "high"))%>%
relocate(seabird_level, .before = breeding_biomass_kgha_side)
fish_comb_dat_levels
#algae n15----
algae_n15<-read.csv("../output/n15_seabirds_combined_no_iti.csv")
algae_n15
fish_comb_dat_levels_algae<-left_join(fish_comb_dat_levels,
select(algae_n15, c("site.name", "N.15_at_10m",  "N.15_at_20m", "N.15_at_30m", "N.15_at_40m")),
by = "site.name")
fish_comb_dat_levels_algae
#to seabird density-----
fish.dens.seabirds.trans
fish_fg_dens_dat_levels<-
fish.dens.seabirds.trans%>%
mutate(seabird_level = case_when(breeding_biomass_kgha_side<10 ~"low",
breeding_biomass_kgha_side>10&breeding_biomass_kgha_side <200 ~"mid",
breeding_biomass_kgha_side>200 ~"high"))%>%
mutate(seabird_level = as.factor(seabird_level))%>%
mutate(seabird_level = fct_relevel(seabird_level, "low", "mid", "high"))%>%
relocate(seabird_level, .before = breeding_biomass_kgha_side)
fish_fg_dens_dat_levels
fish_fg_dens_dat_levels_algae<-left_join(fish_fg_dens_dat_levels,
select(algae_n15, c("site.name", "N.15_at_10m",  "N.15_at_20m", "N.15_at_30m", "N.15_at_40m")),
by = "site.name")
fish_fg_dens_dat_levels_algae
#use log again:
fish_bio_full_mod_algae_log_poly <-lmer(log(sum_fish_biomass)~poly(N.15_at_30m,2)  + wind.exposure + structural_complexity_0to5  + (1|site.name), data = fish_comb_dat_levels_algae) #
summary(fish_bio_full_mod_algae_log_poly)
plot(fish_bio_full_mod_algae_log_poly)
qqnorm(resid(fish_bio_full_mod_algae_log_poly))
qqline(resid(fish_bio_full_mod_algae_log_poly))
Anova(fish_bio_full_mod_algae_log_poly) #nothing significant***
anova(fish_bio_full_mod_algae_log_poly, fish_bio_full_mod_algae_log) #identical AICs
range(fish_comb_dat_levels_algae$N.15_at_30m) #3.430000 6.993333
plot_data_fish_bio_n15_poly<-emmip(fish_bio_full_mod_algae_log_poly, ~ N.15_at_30m, at = list(N.15_at_30m = seq(3.430000, 6.994, by = .01)),
CIs = TRUE, plotit=FALSE) #      type = "response",
plot_data_fish_bio_n15_poly
fish_total_bio_est_plot_n15<-
fish_comb_dat_levels_algae %>%
ggplot(aes(x = N.15_at_30m, y = log(sum_fish_biomass)))+
geom_ribbon(data = plot_data_fish_bio_n15_poly, aes(x = N.15_at_30m, y = yvar, ymin = LCL, ymax=UCL), alpha = .2, lwd=0)+
geom_line(data = plot_data_fish_bio_n15_poly, aes(x = N.15_at_30m, y = yvar))+
geom_point(alpha = .5, aes(color = seabird_level, fill = seabird_level))+
scale_fill_manual(values = c( "low" = "#CD1913", "mid" = "#F2BB05", "high" ="#2F9D3E"))+ #low-mid-high = red-yellow-green
scale_colour_manual(values = c( "low" = "#CD1913", "mid" = "#F2BB05", "high" ="#2F9D3E"))+#low-mid-high = red-yellow-green
ylab("fish biomass (log kg/ha)")+
xlab("algae N15")+
theme_bw() +
theme(panel.grid.major = element_blank(), # remove gridlines
panel.grid.minor = element_blank(), #remove gridlines
strip.background = element_blank(),
legend.position = "none")
fish_total_bio_est_plot_n15
anova(fish_bio_full_mod_algae_log_poly, fish_bio_full_mod_algae_log) #identical AICs
#try with log:
fish_bio_full_mod_sb_level_log <-lmer(log(sum_fish_biomass+1)~seabird_level  + wind.exposure + structural_complexity_0to5  + (1|site.name), data = fish_comb_dat_levels_algae) #depth_max_m + start_distance_to_shore_m  + transect.in.out
anova(fish_bio_full_mod_algae_log_poly, fish_bio_full_mod_algae_log) #identical AICs
#re-run with algae at 30 m:----
fish_bio_full_mod_algae <-lmer(sum_fish_biomass~N.15_at_30m  + wind.exposure + structural_complexity_0to5  + (1|site.name), data = fish_comb_dat_levels_algae) #
#use log again:
fish_bio_full_mod_algae_log <-lmer(log(sum_fish_biomass)~N.15_at_30m  + wind.exposure + structural_complexity_0to5  + (1|site.name), data = fish_comb_dat_levels_algae) #
anova(fish_bio_full_mod_algae_log_poly, fish_bio_full_mod_algae_log) #identical AICs
#compare to no inclusion of algae n15:
fish_bio_full_mod_algae_log_no_algae <-lmer(log(sum_fish_biomass)~ wind.exposure + structural_complexity_0to5  + (1|site.name), data = fish_comb_dat_levels_algae) #
anova(fish_bio_full_mod_algae_log_poly, fish_bio_full_mod_algae_log, fish_bio_full_mod_algae_log_no_algae) #identical AICs
#intercept only:
fish_bio_full_mod_algae_log_int <-lmer(log(sum_fish_biomass)~   (1|site.name), data = fish_comb_dat_levels_algae) #
anova(fish_bio_full_mod_algae_log_poly, fish_bio_full_mod_algae_log, fish_bio_full_mod_algae_log_no_algae, fish_bio_full_mod_algae_log_int) #identical AICs
contrast(emtrends(fish_n15_algae_lm, ~ species, var = "N.15_at_40m"), "poly")
test(emtrends(fish_n15_algae_lm_poly, ~ species, var = "N.15_at_40m", adjust = "fdr", max.degree=2))
anova(fish_n15_gam_lm, fish_n15_gam_1, test = "Chisq")
fish_total_bio_est_plot_n15<-
fish_comb_dat_levels_algae %>%
ggplot(aes(x = N.15_at_30m, y = log(sum_fish_biomass)))+
geom_ribbon(data = plot_data_fish_bio_n15_poly, aes(x = N.15_at_30m, y = yvar, ymin = LCL, ymax=UCL), alpha = .2, lwd=0)+
geom_line(data = plot_data_fish_bio_n15_poly, aes(x = N.15_at_30m, y = yvar))+
geom_point(alpha = .5, aes(color = seabird_level, fill = seabird_level))+
scale_fill_manual(values = c( "low" = "#CD1913", "mid" = "#F2BB05", "high" ="#2F9D3E"))+ #low-mid-high = red-yellow-green
scale_colour_manual(values = c( "low" = "#CD1913", "mid" = "#F2BB05", "high" ="#2F9D3E"))+#low-mid-high = red-yellow-green
ylab("fish biomass (log kg/ha)")+
xlab("algae N15")+
theme_bw() +
theme(panel.grid.major = element_blank(), # remove gridlines
panel.grid.minor = element_blank(), #remove gridlines
strip.background = element_blank(),
legend.position = "none")
fish_total_bio_est_plot_n15
test(emtrends(fish_n15_algae_lm_quad, ~ species, var = "N.15_at_40m", adjust = "fdr"))
test(emtrends(fish_n15_algae_lm_quad, ~ species, var = "I(N.15_at_40m^2)", adjust = "fdr"))
test(emtrends(fish_n15_algae_lm_quad, ~ species, var = "N.15_at_40m", adjust = "fdr", max.degree=2))
#check significance of linear and quad terms in emmeans
test(emtrends(fish_n15_algae_lm_quad1, ~ species, var = "N.15_at_40m", adjust = "fdr", max.degree=2))
fish_n15_algae_lm_quad1<-lm(n15~ N.15_at_40m*species + I(N.15_at_40m^2)*species,
data = fishn15.seabirds.cond.algae)
#check significance of linear and quad terms in emmeans
test(emtrends(fish_n15_algae_lm_quad1, ~ species, var = "N.15_at_40m", adjust = "fdr", max.degree=2))
test(emtrends(fish_n15_algae_lm_quad2, ~ species, var = "N.15_at_40m", adjust = "fdr", max.degree=2))
emmip(fish_n15_algae_lm_quad2, species ~ N.15_at_40m,  at = mylist2, CIs = TRUE, plotit=TRUE)
em_means<-emmeans(fish_n15_algae_lm, pairwise ~  N.15_at_40m|species)
contrast(emtrends(fish_n15_algae_lm, ~ species, var = "N.15_at_40m"), "poly")
contrast(em_means[[1]], "poly")
test(emtrends(fish_n15_algae_lm, ~ species, var = "N.15_at_40m"), interaction = c("poly", "species"))
emmip(fish_n15_algae_lm_poly, ~ N.15_at_40m*species, plotit = TRUE)
summary(fish_n15_algae_lm_poly)
anova(fish_n15_algae_lm_poly)
anova(fish_n15_algae_lm_quad2)
test(emtrends(fish_n15_algae_lm_poly, ~ species, var = "N.15_at_40m", adjust = "fdr", max.degree=2))
fish_n15_algae_lm
em_means<-emmeans(fish_n15_algae_lm, pairwise ~  N.15_at_40m|species)
contrast(emtrends(fish_n15_algae_lm, ~ species, var = "N.15_at_40m"), "poly")
fishn15.seabirds.cond.algae
#compare linear to polynomial model, LRT:-----
fish_n15_algae_lm_linear <- lm(n15 ~ N.15_at_40m*species, data = fishn15.seabirds.cond.algae)
test(emtrends(fish_n15_algae_lm_linear, ~ species, var = "N.15_at_40m", adjust = "fdr", max.degree=2))
anova(fish_n15_algae_lm_linear, fish_n15_algae_lm_poly, fish_n15_algae_lm_quad1, fish_n15_algae_lm_quad2)
anova(fish_n15_algae_lm_linear, fish_n15_algae_lm_poly, fish_n15_algae_lm_quad1, fish_n15_algae_lm_quad2)
anova(fish_n15_algae_lm_linear, fish_n15_algae_lm_quad2)
anova(fish_n15_algae_lm_linear, fish_n15_algae_lm_quad1)
