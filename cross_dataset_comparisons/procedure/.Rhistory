colnames(water.microbes.seabirds)
en <- water.microbes.seabirds[, c(20, 49:52)]
env.fit <- envfit(nmds.rotate, en, permutations = 999, na.rm = TRUE)
plot(nmds.rotate)
plot(env.fit)
en_coord_cont = as.data.frame(scores(env.fit, "vectors")) * ordiArrowMul(env.fit)
en_coord_cont = en_coord_cont %>% mutate(var.name = c("Algal N15", "Richness", "Shannon", "Evenness"))
nmds.scores <- as.data.frame(scores(nmds.rotate)$sites)
#combine with other relevant data
nmds.scores$N15 <- water.microbes.seabirds$algae.N15
nmds.scores$site.name <- water.microbes.seabirds$site.name
nmds.scores$distance.along.transect <- water.microbes.seabirds$distance.along.transect
nmds.scores$exposure <- water.microbes.seabirds$island.side
water.microbe.nmds.plot.rotate <-
ggplot() +
geom_point(data=nmds.scores,aes(x=NMDS1,y=NMDS2,colour=N15, shape = exposure), stat="identity", size=5, alpha = .9) +
scale_color_distiller(palette = "YlGnBu") +
geom_segment(data = en_coord_cont,
aes(x = 0, xend = NMDS1, y = 0, yend = NMDS2),
arrow = arrow(length = unit(0.25, "cm"))) +
geom_text(data = en_coord_cont, aes(x = NMDS1, y = NMDS2 +0.06, label = en_coord_cont$var.name),
size = 3, vjust = "outward", fontface = "bold")+
labs(colour = expression(algal~delta^15~N), fill = expression(algal~delta^15~N))+
#geom_point(data = en_coord_cat, aes(x = NMDS1, y = NMDS2),
#    shape = "diamond", size = 4, alpha = 0.6, colour = "gray30") +
#geom_text(data = en_coord_cat, aes(x = NMDS1, y = NMDS2 - 0.06, label = en_coord_cat$var.name),
#          size = 3, vjust = "outward", fontface = "bold", colour = "gray30")+
theme_bw() +
theme(panel.grid.major = element_blank(), # remove gridlines
panel.grid.minor = element_blank(), #remove gridlines
strip.background = element_blank(),
legend.position = c(.88, .8))
water.microbe.nmds.plot.rotate
env.fit
env.fit <- envfit(nmds.rotate ~ water.microbes.seabirds$algae.N15, permutations = 999, na.rm = TRUE)
en_coord_cont = en_coord_cont %>% mutate(var.name = c("Algal N15"))
env.fit <- envfit(nmds.rotate ~ water.microbes.seabirds$algae.N15, permutations = 999, na.rm = TRUE)
env.fit
en_coord_cont = as.data.frame(scores(env.fit, "vectors")) * ordiArrowMul(env.fit)
en_coord_cont = en_coord_cont %>% mutate(var.name = c("Algal N15"))
nmds.scores <- as.data.frame(scores(nmds.rotate)$sites)
#combine with other relevant data
nmds.scores$N15 <- water.microbes.seabirds$algae.N15
nmds.scores$site.name <- water.microbes.seabirds$site.name
nmds.scores$distance.along.transect <- water.microbes.seabirds$distance.along.transect
nmds.scores$exposure <- water.microbes.seabirds$island.side
water.microbe.nmds.plot.rotate <-
ggplot() +
geom_point(data=nmds.scores,aes(x=NMDS1,y=NMDS2,colour=N15, shape = exposure), stat="identity", size=5, alpha = .9) +
scale_color_distiller(palette = "YlGnBu") +
geom_segment(data = en_coord_cont,
aes(x = 0, xend = NMDS1, y = 0, yend = NMDS2),
arrow = arrow(length = unit(0.25, "cm"))) +
geom_text(data = en_coord_cont, aes(x = NMDS1, y = NMDS2 +0.06, label = en_coord_cont$var.name),
size = 3, vjust = "outward", fontface = "bold")+
labs(colour = expression(algal~delta^15~N), fill = expression(algal~delta^15~N))+
#geom_point(data = en_coord_cat, aes(x = NMDS1, y = NMDS2),
#    shape = "diamond", size = 4, alpha = 0.6, colour = "gray30") +
#geom_text(data = en_coord_cat, aes(x = NMDS1, y = NMDS2 - 0.06, label = en_coord_cat$var.name),
#          size = 3, vjust = "outward", fontface = "bold", colour = "gray30")+
theme_bw() +
theme(panel.grid.major = element_blank(), # remove gridlines
panel.grid.minor = element_blank(), #remove gridlines
strip.background = element_blank(),
legend.position = c(.88, .8))
water.microbe.nmds.plot.rotate
water.microbe.nmds.plot.rotate <-
ggplot() +
geom_point(data=nmds.scores,aes(x=NMDS1,y=NMDS2,colour=N15, shape = exposure), stat="identity", size=5, alpha = .9) +
scale_color_distiller(palette = "YlGnBu") +
geom_segment(data = en_coord_cont,
aes(x = 0, xend = NMDS1, y = 0, yend = NMDS2),
arrow = arrow(length = unit(0.25, "cm"))) +
geom_text(data = en_coord_cont, aes(x = NMDS1, y = NMDS2 +0.06, label = en_coord_cont$var.name),
size = 3, vjust = "outward", fontface = "bold")+
labs(colour = expression(algal~delta^15~N), fill = expression(algal~delta^15~N))+
#geom_point(data = en_coord_cat, aes(x = NMDS1, y = NMDS2),
#    shape = "diamond", size = 4, alpha = 0.6, colour = "gray30") +
#geom_text(data = en_coord_cat, aes(x = NMDS1, y = NMDS2 - 0.06, label = en_coord_cat$var.name),
#          size = 3, vjust = "outward", fontface = "bold", colour = "gray30")+
theme_bw() +
theme(panel.grid.major = element_blank(), # remove gridlines
panel.grid.minor = element_blank(), #remove gridlines
strip.background = element_blank(),
legend.position = c(.25, .25),
legend.box = "horizontal")
water.microbe.nmds.plot.rotate
ggsave(water.microbe.nmds.plot.rotate, file = "../output/2b_NMDS_WaterMicrobe_div_CB.jpg",
width = 7, height = 5)
bc.coral <- phyloseq::distance(physeq.coral.r, method = "bray")
distlm_coralmicro_n15<-vegan::adonis2(bc.coral ~ algae.N15 * distance.along.transect  + Exposure,  data = coral.microbes.seabirds, method = "bray", permutations = 999, na.action = na.omit)
distlm_coralmicro_n15
distlm_coralmicro_n15<-vegan::adonis2(physeq.coral.r ~ algae.N15 * distance.along.transect  + Exposure,  data = coral.microbes.seabirds, method = "bray", permutations = 999, na.action = na.omit)
physeq.coral.r
distlm_coralmicro_n15<-vegan::adonis2(bc.coral ~ algae.N15 * distance.along.transect  + Exposure,  data = coral.microbes.seabirds, method = "bray", permutations = 999, na.action = na.omit)
distlm_coralmicro_n15
#with exposure interaction:
distlm_coralmicro_n15<-vegan::adonis2(bc.coral ~ algae.N15 * Exposure,  data = coral.microbes.seabirds, method = "bray", permutations = 999, na.action = na.omit)
distlm_coralmicro_n15
bc.water <- phyloseq::distance(physeq.water.r, method = "bray")
distlm_watermicro_n15<-vegan::adonis2(bc.water ~ algae.N15 * distance.along.transect  + Exposure,  data = water.microbes.seabirds, method = "bray", permutations = 999, na.action = na.omit)
distlm_watermicro_n15
#with exposure interaction:
distlm_watermicro_n15<-vegan::adonis2(bc.water ~ algae.N15 * Exposure,  data = water.microbes.seabirds, method = "bray", permutations = 999, na.action = na.omit)
distlm_watermicro_n15
ggplot(water.microbes.seabirds, aes(x = algae.N15, y = Observed, color = Exposure,
fill = Exposure, group = Exposure))+
#geom_point(stat = "summary", fun = "mean", alpha = 0.5, size  = 3) +
geom_point(aes(shape = Exposure))+
geom_line(data = rich_plot_dat.protected, aes(x = algae.N15, y = yvar))+
geom_ribbon(data = rich_plot_dat.protected, aes(x = algae.N15, y = yvar, ymin = LCL, ymax=UCL, fill = Exposure, color = Exposure), alpha = .2, lwd=0)+
geom_line(data = rich_plot_dat.exposed, aes(x = algae.N15, y = yvar))+
geom_ribbon(data = rich_plot_dat.exposed, aes(x = algae.N15, y = yvar, ymin = LCL, ymax=UCL, fill = Exposure, color = Exposure), alpha = .2, lwd=0)+
ylab("Microbial Observed ASV richness \n") +
xlab(expression(italic(delta)^15*N))+
scale_fill_manual(values = my_colors, labels = c('windward', 'leeward'))+
scale_color_manual(values = my_colors, labels = c('windward', 'leeward')) +
scale_shape_manual(values = c(24,  21), labels = c('windward', 'leeward'))+
theme_classic() +
theme(legend.position = c(0.85, 0.82)) +
theme(panel.border = element_rect(color = "black", fill = NA, linetype = 1, linewidth = 0.5))
library(tidyverse)
library(plyr)
library(jtools)
library(multcompView)
library(multcomp)
library(MASS) #for glmms
library(glmmTMB) #for glmms with a beta distribution
library(nlme) #for linear mixed effects models
library(lme4) #for linear mixed effects models
library(emmeans) #for multiple comparisons
library(car) #for qqplots
library(vcd) #for distplots of non-gaussian distributions
library(sjPlot)
library(mgcv) #for running beta distributions
#Bring in Microbes and seabird data
seabirds <- read.csv("../output/n15_seabirds_combined_no_iti.csv", strip.white = T, header = T)
microbes <- read.csv("../../microbiome_analyses/downstream_analyses/integration/output/nov2021_microbiome_metrics.csv")
#recode the site.name category so we can combine with seabird data
microbes$site.name[microbes$site.name == "A1"] <- "Aie_Protected"
microbes$site.name[microbes$site.name == "A2"] <- "Aie_Exposed"
microbes$site.name[microbes$site.name == "Re1"] <- "Reiono_Protected"
microbes$site.name[microbes$site.name == "Re2"] <- "Reiono_Exposed"
microbes$site.name[microbes$site.name == "Rm1"] <- "Rimatuu_Protected"
microbes$site.name[microbes$site.name == "Rm2"] <- "Rimatuu_Exposed"
microbes$site.name <- as.factor(microbes$site.name)
levels(microbes$site.name)
#Combine with seabird data:
microbes.seabirds <- merge(microbes, seabirds, by = "site.name", all = TRUE, no.dups = TRUE)
head(microbes.seabirds)
#Add a seabird level category
microbes.seabirds <-
microbes.seabirds%>%
mutate(seabird_level = case_when(breeding_biomass_kgha_side<10 ~"low",
breeding_biomass_kgha_side>10&breeding_biomass_kgha_side <200 ~"mid",
breeding_biomass_kgha_side>200 ~"high"))%>%
mutate(seabird_level = as.factor(seabird_level))%>%
mutate(seabird_level = fct_relevel(seabird_level, "low", "mid", "high"))
str(microbes.seabirds$distance.along.transect)
microbes.seabirds$Distance_to_shore <- as.factor(microbes.seabirds$distance.along.transect)
str(microbes.seabirds$seabird_level)
coral.microbes.seabirds <- microbes.seabirds %>% filter(sample.type == "coral")
water.microbes.seabirds <- microbes.seabirds %>% filter(sample.type ==  "water")
wat.rich.glm <- glmer(Observed~algae.N15*Exposure + (1|site.name), family = "poisson", data = water.microbes.seabirds)
test(emtrends(wat.rich.glm, pairwise~ Exposure, var = "algae.N15", adjust = "fdr"))
range(water.microbes.seabirds$algae.N15, na.rm = T) #these should all be the same as above
rich_plot_dat <- emmip(wat.rich.glm,  ~ algae.N15|Exposure, at = list(algae.N15 = seq(2.73, 10.66, 0.1)), CIs = TRUE, plotit=FALSE, type = "response")
range(water.microbes.seabirds[water.microbes.seabirds$Exposure == "Protected",]$algae.N15, na.rm = T) #2.73, 10.66
range(water.microbes.seabirds[water.microbes.seabirds$Exposure == "Exposed",]$algae.N15, na.rm = T) #4.64, 8.45
rich_plot_dat.protected<-
rich_plot_dat%>%
filter(Exposure == "Protected")%>%
filter(algae.N15>=2.73&algae.N15<=10.66)
rich_plot_dat.exposed<-
rich_plot_dat%>%
filter(Exposure == "Exposed")%>%
filter(algae.N15>=4.64&algae.N15<=8.45)
my_colors <- RColorBrewer::brewer.pal(3, "Dark2")[c(1,2)]
##Plot the richness according to N15 & exposure
ggplot(water.microbes.seabirds, aes(x = algae.N15, y = Observed, color = Exposure,
fill = Exposure, group = Exposure))+
#geom_point(stat = "summary", fun = "mean", alpha = 0.5, size  = 3) +
geom_point(aes(shape = Exposure))+
geom_line(data = rich_plot_dat.protected, aes(x = algae.N15, y = yvar))+
geom_ribbon(data = rich_plot_dat.protected, aes(x = algae.N15, y = yvar, ymin = LCL, ymax=UCL, fill = Exposure, color = Exposure), alpha = .2, lwd=0)+
geom_line(data = rich_plot_dat.exposed, aes(x = algae.N15, y = yvar))+
geom_ribbon(data = rich_plot_dat.exposed, aes(x = algae.N15, y = yvar, ymin = LCL, ymax=UCL, fill = Exposure, color = Exposure), alpha = .2, lwd=0)+
ylab("Microbial Observed ASV richness \n") +
xlab(expression(italic(delta)^15*N))+
scale_fill_manual(values = my_colors, labels = c('windward', 'leeward'))+
scale_color_manual(values = my_colors, labels = c('windward', 'leeward')) +
scale_shape_manual(values = c(24,  21), labels = c('windward', 'leeward'))+
theme_classic() +
theme(legend.position = c(0.85, 0.82)) +
theme(panel.border = element_rect(color = "black", fill = NA, linetype = 1, linewidth = 0.5))
##Plot the richness according to N15 & exposure (combined effect line)--=--
ggplot(water.microbes.seabirds, aes(x = algae.N15, y = Observed))+
#geom_point(stat = "summary", fun = "mean", alpha = 0.5, size  = 3) +
geom_point(aes(fill = Exposure, colour = Exposure, shape = Exposure))+
geom_line(data = rich_plot_dat_no_exp, aes(x = algae.N15, y = yvar))+
geom_ribbon(data = rich_plot_dat_no_exp, aes(x = algae.N15, y = yvar, ymin = LCL, ymax=UCL), alpha = .2, lwd=0)+
ylab("Microbial Observed ASV richness \n") +
xlab(expression(italic(delta)^15*N))+
scale_fill_manual(values = my_colors, labels = c('windward', 'leeward'))+
scale_color_manual(values = my_colors, labels = c('windward', 'leeward')) +
scale_shape_manual(values = c(24,  21), labels = c('windward', 'leeward'))+
theme_classic() +
theme(legend.position = c(0.85, 0.75)) +
theme(panel.border = element_rect(color = "black", fill = NA, linetype = 1, linewidth = 0.5))
rich_plot_dat_no_exp <- emmip(wat.rich.glm,  ~ algae.N15, at = list(algae.N15 = seq(2.73, 10.66, .1)), CIs = TRUE, plotit=FALSE, type = "response")
##Plot the richness according to N15 & exposure (combined effect line)--=--
ggplot(water.microbes.seabirds, aes(x = algae.N15, y = Observed))+
#geom_point(stat = "summary", fun = "mean", alpha = 0.5, size  = 3) +
geom_point(aes(fill = Exposure, colour = Exposure, shape = Exposure))+
geom_line(data = rich_plot_dat_no_exp, aes(x = algae.N15, y = yvar))+
geom_ribbon(data = rich_plot_dat_no_exp, aes(x = algae.N15, y = yvar, ymin = LCL, ymax=UCL), alpha = .2, lwd=0)+
ylab("Microbial Observed ASV richness \n") +
xlab(expression(italic(delta)^15*N))+
scale_fill_manual(values = my_colors, labels = c('windward', 'leeward'))+
scale_color_manual(values = my_colors, labels = c('windward', 'leeward')) +
scale_shape_manual(values = c(24,  21), labels = c('windward', 'leeward'))+
theme_classic() +
theme(legend.position = c(0.85, 0.75)) +
theme(panel.border = element_rect(color = "black", fill = NA, linetype = 1, linewidth = 0.5))
##Plot the richness according to N15 & exposure
ggplot(water.microbes.seabirds, aes(x = algae.N15, y = Observed, color = Exposure,
fill = Exposure, group = Exposure))+
#geom_point(stat = "summary", fun = "mean", alpha = 0.5, size  = 3) +
geom_point(aes(shape = Exposure))+
geom_line(data = rich_plot_dat.protected, aes(x = algae.N15, y = yvar))+
geom_ribbon(data = rich_plot_dat.protected, aes(x = algae.N15, y = yvar, ymin = LCL, ymax=UCL, fill = Exposure, color = Exposure), alpha = .2, lwd=0)+
geom_line(data = rich_plot_dat.exposed, aes(x = algae.N15, y = yvar))+
geom_ribbon(data = rich_plot_dat.exposed, aes(x = algae.N15, y = yvar, ymin = LCL, ymax=UCL, fill = Exposure, color = Exposure), alpha = .2, lwd=0)+
ylab("Microbial Observed ASV richness \n") +
xlab(expression(italic(delta)^15*N))+
scale_fill_manual(values = my_colors, labels = c('windward', 'leeward'))+
scale_color_manual(values = my_colors, labels = c('windward', 'leeward')) +
scale_shape_manual(values = c(24,  21), labels = c('windward', 'leeward'))+
theme_classic() +
theme(legend.position = c(0.85, 0.82)) +
theme(panel.border = element_rect(color = "black", fill = NA, linetype = 1, linewidth = 0.5))
ggsave("../output/seabird-microbes/clean_output/4_water_micro-richness_model_w_exp_HE.jpg", plot = last_plot(), width = 7, height = 5)
rich_plot_dat <- emmip(wat.rich.glm,  ~ algae.N15|Exposure, at = list(algae.N15 = seq(2.73, 10.66, 0.1)), CIs = TRUE, plotit=FALSE, type = "response")
range(water.microbes.seabirds[water.microbes.seabirds$Exposure == "Protected",]$algae.N15, na.rm = T) #2.73, 10.66
range(water.microbes.seabirds[water.microbes.seabirds$Exposure == "Exposed",]$algae.N15, na.rm = T) #4.64, 8.45
rich_plot_dat.protected<-
rich_plot_dat%>%
filter(Exposure == "Protected")%>%
filter(algae.N15>=2.73&algae.N15<=10.66)
rich_plot_dat.exposed<-
rich_plot_dat%>%
filter(Exposure == "Exposed")%>%
filter(algae.N15>=4.64&algae.N15<=8.45)
my_colors <- RColorBrewer::brewer.pal(3, "Dark2")[c(1,2)]
##Plot the richness according to N15 & exposure
ggplot(water.microbes.seabirds, aes(x = algae.N15, y = Observed, color = Exposure,
fill = Exposure, group = Exposure))+
#geom_point(stat = "summary", fun = "mean", alpha = 0.5, size  = 3) +
geom_point(aes(shape = Exposure))+
geom_line(data = rich_plot_dat.protected, aes(x = algae.N15, y = yvar))+
geom_ribbon(data = rich_plot_dat.protected, aes(x = algae.N15, y = yvar, ymin = LCL, ymax=UCL, fill = Exposure, color = Exposure), alpha = .2, lwd=0)+
geom_line(data = rich_plot_dat.exposed, aes(x = algae.N15, y = yvar))+
geom_ribbon(data = rich_plot_dat.exposed, aes(x = algae.N15, y = yvar, ymin = LCL, ymax=UCL, fill = Exposure, color = Exposure), alpha = .2, lwd=0)+
ylab("Microbial Observed ASV richness \n") +
xlab(expression(italic(delta)^15*N))+
scale_fill_manual(values = my_colors, labels = c('windward', 'leeward'))+
scale_color_manual(values = my_colors, labels = c('windward', 'leeward')) +
scale_shape_manual(values = c(24,  21), labels = c('windward', 'leeward'))+
theme_classic() +
theme(legend.position = c(0.85, 0.82)) +
theme(panel.border = element_rect(color = "black", fill = NA, linetype = 1, linewidth = 0.5))
ggplot(water.microbes.seabirds, aes(x = algae.N15, y = Observed))+
#geom_point(stat = "summary", fun = "mean", alpha = 0.5, size  = 3) +
geom_point(aes(fill = motu, colour = motu, shape = Exposure))+
geom_line(data = syn_plot_dat_no_exp, aes(x = algae.N15, y = yvar))+
geom_ribbon(data = syn_plot_dat_no_exp, aes(x = algae.N15, y = yvar, ymin = LCL, ymax=UCL), alpha = .2, lwd=0)+
ylab("Microbial Observed ASV richness \n") +
xlab(expression(italic(delta)^15*N))+
scale_fill_manual(values = my_colors_3, labels = c('Aie', 'Reiono', 'Rimatuu'))+
scale_color_manual(values = my_colors_3, labels = c('Aie', 'Reiono', 'Rimatuu')) +
scale_shape_manual(values = c(24,  21), labels = c('windward', 'leeward'))+
theme_classic() +
theme(legend.position = c(0.9, 0.7)) +
theme(panel.border = element_rect(color = "black", fill = NA, linetype = 1, linewidth = 0.5))
ggplot(water.microbes.seabirds, aes(x = algae.N15, y = Observed))+
#geom_point(stat = "summary", fun = "mean", alpha = 0.5, size  = 3) +
geom_point(aes(fill = motu, colour = motu, shape = Exposure))+
geom_line(data = rich_plot_dat, aes(x = algae.N15, y = yvar))+
geom_ribbon(data = rich_plot_dat, aes(x = algae.N15, y = yvar, ymin = LCL, ymax=UCL), alpha = .2, lwd=0)+
ylab("Microbial Observed ASV richness \n") +
xlab(expression(italic(delta)^15*N))+
scale_fill_manual(values = my_colors_3, labels = c('Aie', 'Reiono', 'Rimatuu'))+
scale_color_manual(values = my_colors_3, labels = c('Aie', 'Reiono', 'Rimatuu')) +
scale_shape_manual(values = c(24,  21), labels = c('windward', 'leeward'))+
theme_classic() +
theme(legend.position = c(0.9, 0.7)) +
theme(panel.border = element_rect(color = "black", fill = NA, linetype = 1, linewidth = 0.5))
#try plotting by motu-----
my_colors_3 <- RColorBrewer::brewer.pal(3, "Dark2")[c(1:3)]
ggplot(water.microbes.seabirds, aes(x = algae.N15, y = Observed))+
#geom_point(stat = "summary", fun = "mean", alpha = 0.5, size  = 3) +
geom_point(aes(fill = motu, colour = motu, shape = Exposure))+
geom_line(data = rich_plot_dat, aes(x = algae.N15, y = yvar))+
geom_ribbon(data = rich_plot_dat, aes(x = algae.N15, y = yvar, ymin = LCL, ymax=UCL), alpha = .2, lwd=0)+
ylab("Microbial Observed ASV richness \n") +
xlab(expression(italic(delta)^15*N))+
scale_fill_manual(values = my_colors_3, labels = c('Aie', 'Reiono', 'Rimatuu'))+
scale_color_manual(values = my_colors_3, labels = c('Aie', 'Reiono', 'Rimatuu')) +
scale_shape_manual(values = c(24,  21), labels = c('windward', 'leeward'))+
theme_classic() +
theme(legend.position = c(0.9, 0.7)) +
theme(panel.border = element_rect(color = "black", fill = NA, linetype = 1, linewidth = 0.5))
ggplot(water.microbes.seabirds, aes(x = algae.N15, y = Observed))+
#geom_point(stat = "summary", fun = "mean", alpha = 0.5, size  = 3) +
geom_point(aes(fill = motu, colour = motu, shape = Exposure))+
geom_ribbon(data = rich_plot_dat.protected, aes(x = algae.N15, y = yvar, ymin = LCL, ymax=UCL, fill = Exposure, color = Exposure), alpha = .2, lwd=0)+
geom_line(data = rich_plot_dat.exposed, aes(x = algae.N15, y = yvar))+
geom_ribbon(data = rich_plot_dat.exposed, aes(x = algae.N15, y = yvar, ymin = LCL, ymax=UCL, fill = Exposure, color = Exposure), alpha = .2, lwd=0)+
ylab("Microbial Observed ASV richness \n") +
xlab(expression(italic(delta)^15*N))+
scale_fill_manual(values = my_colors_3, labels = c('Aie', 'Reiono', 'Rimatuu'))+
scale_color_manual(values = my_colors_3, labels = c('Aie', 'Reiono', 'Rimatuu')) +
scale_shape_manual(values = c(24,  21), labels = c('windward', 'leeward'))+
theme_classic() +
theme(legend.position = c(0.9, 0.7)) +
theme(panel.border = element_rect(color = "black", fill = NA, linetype = 1, linewidth = 0.5))
ggplot(water.microbes.seabirds, aes(x = algae.N15, y = Observed))+
#geom_point(stat = "summary", fun = "mean", alpha = 0.5, size  = 3) +
geom_point(aes(fill = motu, colour = motu, shape = Exposure))+
geom_line(data = rich_plot_dat_no_exp, aes(x = algae.N15, y = yvar))+
geom_ribbon(data = rich_plot_dat_no_exp, aes(x = algae.N15, y = yvar, ymin = LCL, ymax=UCL), alpha = .2, lwd=0)+
ylab("Microbial Observed ASV richness \n") +
xlab(expression(italic(delta)^15*N))+
scale_fill_manual(values = my_colors_3, labels = c('Aie', 'Reiono', 'Rimatuu'))+
scale_color_manual(values = my_colors_3, labels = c('Aie', 'Reiono', 'Rimatuu')) +
scale_shape_manual(values = c(24,  21), labels = c('windward', 'leeward'))+
theme_classic() +
theme(legend.position = c(0.9, 0.7)) +
theme(panel.border = element_rect(color = "black", fill = NA, linetype = 1, linewidth = 0.5))
water.microbes.seabirds.noaiepro <- filter(water.microbes.seabirds, site.name != "Aie_Protected")
wat.rich.glm.noaie <- glmer(Observed~algae.N15*Exposure + (1|site.name), family = "poisson", data = water.microbes.seabirds.noaiepro)
Anova(wat.rich.glm.noaie)
#plot it-----
rich_plot_dat <- emmip(wat.rich.glm.noaie,  ~ algae.N15|Exposure, at = list(algae.N15 = seq(2.73, 10.66, 0.1)), CIs = TRUE, plotit=FALSE, type = "response")
range(water.microbes.seabirds[water.microbes.seabirds$Exposure == "Protected",]$algae.N15, na.rm = T) #2.73, 10.66
range(water.microbes.seabirds[water.microbes.seabirds$Exposure == "Exposed",]$algae.N15, na.rm = T) #4.64, 8.45
rich_plot_dat.protected<-
rich_plot_dat%>%
filter(Exposure == "Protected")%>%
filter(algae.N15>=2.73&algae.N15<=10.66)
rich_plot_dat.exposed<-
rich_plot_dat%>%
filter(Exposure == "Exposed")%>%
filter(algae.N15>=4.64&algae.N15<=8.45)
my_colors <- RColorBrewer::brewer.pal(3, "Dark2")[c(1,2)]
range(water.microbes.seabirds.noaiepro[water.microbes.seabirds.noaiepro$Exposure == "Protected",]$algae.N15, na.rm = T) #2.73, 10.66
range(water.microbes.seabirds.noaiepro[water.microbes.seabirds.noaiepro$Exposure == "Exposed",]$algae.N15, na.rm = T) #4.64, 8.45
water.microbes.seabirds.noaiepro
rich_plot_dat.protected<-
rich_plot_dat%>%
filter(Exposure == "Protected")%>%
filter(algae.N15>=2.73&algae.N15<=10.66)
my_colors <- RColorBrewer::brewer.pal(3, "Dark2")[c(1,2)]
##Plot the richness according to N15 & exposure
ggplot(water.microbes.seabirds.noaiepro, aes(x = algae.N15, y = Observed, color = Exposure,
fill = Exposure, group = Exposure))+
#geom_point(stat = "summary", fun = "mean", alpha = 0.5, size  = 3) +
geom_point(aes(shape = Exposure))+
geom_line(data = rich_plot_dat.protected, aes(x = algae.N15, y = yvar))+
geom_ribbon(data = rich_plot_dat.protected, aes(x = algae.N15, y = yvar, ymin = LCL, ymax=UCL, fill = Exposure, color = Exposure), alpha = .2, lwd=0)+
geom_line(data = rich_plot_dat.exposed, aes(x = algae.N15, y = yvar))+
geom_ribbon(data = rich_plot_dat.exposed, aes(x = algae.N15, y = yvar, ymin = LCL, ymax=UCL, fill = Exposure, color = Exposure), alpha = .2, lwd=0)+
ylab("Microbial Observed ASV richness \n") +
xlab(expression(italic(delta)^15*N))+
scale_fill_manual(values = my_colors, labels = c('windward', 'leeward'))+
scale_color_manual(values = my_colors, labels = c('windward', 'leeward')) +
scale_shape_manual(values = c(24,  21), labels = c('windward', 'leeward'))+
theme_classic() +
theme(legend.position = c(0.85, 0.82)) +
theme(panel.border = element_rect(color = "black", fill = NA, linetype = 1, linewidth = 0.5))
##Plot the richness according to N15 & exposure
ggplot(water.microbes.seabirds.noaiepro, aes(x = algae.N15, y = Observed, color = Exposure,
fill = Exposure, group = Exposure))+
#geom_point(stat = "summary", fun = "mean", alpha = 0.5, size  = 3) +
geom_point(aes(shape = Exposure))+
geom_line(data = rich_plot_dat.protected, aes(x = algae.N15, y = yvar))+
geom_ribbon(data = rich_plot_dat.protected, aes(x = algae.N15, y = yvar, ymin = LCL, ymax=UCL, fill = Exposure, color = Exposure), alpha = .2, lwd=0)+
geom_line(data = rich_plot_dat.exposed, aes(x = algae.N15, y = yvar))+
geom_ribbon(data = rich_plot_dat.exposed, aes(x = algae.N15, y = yvar, ymin = LCL, ymax=UCL, fill = Exposure, color = Exposure), alpha = .2, lwd=0)+
ylab("Microbial Observed ASV richness \n") +
xlab(expression(italic(delta)^15*N))+
scale_fill_manual(values = my_colors, labels = c('windward', 'leeward'))+
scale_color_manual(values = my_colors, labels = c('windward', 'leeward')) +
scale_shape_manual(values = c(24,  21), labels = c('windward', 'leeward'))+
theme_classic() +
theme(legend.position = c(0.85, 0.25)) +
theme(panel.border = element_rect(color = "black", fill = NA, linetype = 1, linewidth = 0.5))
ggsave("../output/seabird-microbes/clean_output/4_water_micro-richness_model_w_exp_no_aie_HE.jpg", plot = last_plot(), width = 7, height = 5)
#to get effect size, exponentiate (log-link in Poisson):
exp(0.103)
exp(0.164)
range(coral.microbes.seabirds$algae.N15, na.rm = T)
rich_plot_dat <- emmip(cor.rich.glm,  ~ algae.N15|Exposure, at = list(algae.N15 = seq(2.73, 10.66, 0.1)), CIs = TRUE, plotit=FALSE, type = "response")
cor.rich.glm <- glmer(Observed~algae.N15*Exposure + (1|site.name), family = "poisson", data = coral.microbes.seabirds)
rich_plot_dat <- emmip(cor.rich.glm,  ~ algae.N15|Exposure, at = list(algae.N15 = seq(2.73, 10.66, 0.1)), CIs = TRUE, plotit=FALSE, type = "response")
range(coral.microbes.seabirds[coral.microbes.seabirds$Exposure == "Protected",]$algae.N15, na.rm = T) #2.73, 10.66
range(coral.microbes.seabirds[coral.microbes.seabirds$Exposure == "Exposed",]$algae.N15, na.rm = T) #4.64, 8.45
rich_plot_dat.protected<-
rich_plot_dat%>%
filter(Exposure == "Protected")%>%
filter(algae.N15>=2.73&algae.N15<=10.66)
rich_plot_dat.exposed<-
rich_plot_dat%>%
filter(Exposure == "Exposed")%>%
filter(algae.N15>=4.64&algae.N15<=8.45)
my_colors <- RColorBrewer::brewer.pal(3, "Dark2")[c(1,2)]
##Plot the richness according to N15 & exposure
ggplot(coral.microbes.seabirds, aes(x = algae.N15, y = Observed, color = Exposure,
fill = Exposure, group = Exposure))+
#geom_point(stat = "summary", fun = "mean", alpha = 0.5, size  = 3) +
geom_point(aes(shape = Exposure))+
geom_line(data = rich_plot_dat.protected, aes(x = algae.N15, y = yvar))+
geom_ribbon(data = rich_plot_dat.protected, aes(x = algae.N15, y = yvar, ymin = LCL, ymax=UCL, fill = Exposure, color = Exposure), alpha = .2, lwd=0)+
geom_line(data = rich_plot_dat.exposed, aes(x = algae.N15, y = yvar))+
geom_ribbon(data = rich_plot_dat.exposed, aes(x = algae.N15, y = yvar, ymin = LCL, ymax=UCL, fill = Exposure, color = Exposure), alpha = .2, lwd=0)+
ylab("Microbial Observed ASV richness \n") +
xlab(expression(italic(delta)^15*N))+
scale_fill_manual(values = my_colors, labels = c('windward', 'leeward'))+
scale_color_manual(values = my_colors, labels = c('windward', 'leeward')) +
scale_shape_manual(values = c(24,  21), labels = c('windward', 'leeward'))+
theme_classic() +
theme(legend.position = c(0.85, 0.82)) +
theme(panel.border = element_rect(color = "black", fill = NA, linetype = 1, linewidth = 0.5))
ggsave("../output/seabird-microbes/clean_output/1_coral_micro-richness_model_HE_w_exp.jpg", plot = last_plot(), width = 7, height = 5)
hist(coral.microbes.seabirds$RelAbund_Endozoicomonas)
qqPlot(coral.microbes.seabirds$RelAbund_Endozoicomonas)#terrible
#Hmmm can't use log-link because it is skewed the opposite way.
#What about proportional data?
##Since Endoz are skewed toward 1, what about using a beta distribution?
?glmmTMB()
#Cool let's loop!
head(coral.microbes.seabirds)
###If they are all betas, can we transform & then loop it
beta_trans_coral_microbes <- dplyr::mutate(coral.microbes.seabirds, RelAbund_Cellvibrionales_Aestuariicella = (RelAbund_Cellvibrionales_Aestuariicella*(n()-1) + 0.5)/n())
beta_trans_coral_microbes <- dplyr::mutate(beta_trans_coral_microbes, RelAbund_Alteromonadales_Agaribacter = (RelAbund_Alteromonadales_Agaribacter*(n()-1) + 0.5)/n())
beta_trans_coral_microbes <- dplyr::mutate(beta_trans_coral_microbes, RelAbund_Cytophagales_Candidatus_Amoebophilus = (RelAbund_Cytophagales_Candidatus_Amoebophilus*(n()-1) + 0.5)/n())
beta_trans_coral_microbes <- dplyr::mutate(beta_trans_coral_microbes, RelAbund_Endozoicomonas = (RelAbund_Endozoicomonas*(n()-1) + 0.5)/n())
beta_trans_coral_microbes <- dplyr::mutate(beta_trans_coral_microbes, RelAbund_Alteromonadales_Glaciecola = (RelAbund_Alteromonadales_Glaciecola*(n()-1) + 0.5)/n())
beta_trans_coral_microbes <- dplyr::mutate(beta_trans_coral_microbes, RelAbund_Oceanospirillales_Neptuniibacter = (RelAbund_Oceanospirillales_Neptuniibacter*(n()-1) + 0.5)/n())
beta_trans_coral_microbes <- dplyr::mutate(beta_trans_coral_microbes, RelAbund_Cellvibrionales_Porticoccus = (RelAbund_Cellvibrionales_Porticoccus*(n()-1) + 0.5)/n())
beta_trans_coral_microbes <- dplyr::mutate(beta_trans_coral_microbes, RelAbund_Woesearchaeales_SCGC_AAA286E23 = (RelAbund_Woesearchaeales_SCGC_AAA286E23*(n()-1) + 0.5)/n())
beta_trans_coral_microbes <- dplyr::mutate(beta_trans_coral_microbes, RelAbund_Litoricola = (RelAbund_Litoricola*(n()-1) + 0.5)/n())
beta_trans_coral_microbes <- dplyr::mutate(beta_trans_coral_microbes, RelAbund_Uncultured_Alteromonadaceaeae = (RelAbund_Uncultured_Alteromonadaceaeae*(n()-1) + 0.5)/n())
print(colnames(beta_trans_coral_microbes))
columns <- c( "RelAbund_Cellvibrionales_Aestuariicella" , "RelAbund_Alteromonadales_Agaribacter",
"RelAbund_Cytophagales_Candidatus_Amoebophilus", "RelAbund_Endozoicomonas","RelAbund_Alteromonadales_Glaciecola",
"RelAbund_Oceanospirillales_Neptuniibacter","RelAbund_Cellvibrionales_Porticoccus",
"RelAbund_Woesearchaeales_SCGC_AAA286E23","RelAbund_Litoricola","RelAbund_Uncultured_Alteromonadaceaeae")
#Loop
dat <- beta_trans_coral_microbes
models <- list()
for (i in columns) {
f <- formula(paste(i, "~ algae.N15*Exposure + (1|site.name)"))
models[[i]] <- glmmTMB(f, data=dat, family = beta_family(), na.action = na.omit)
print(Anova(models[[i]]))
}
#Interesting, none of the top taxa have any significant differences..
hist(water.microbes.seabirds$RelAbund_Synechococcus)
qqPlot(water.microbes.seabirds$RelAbund_Synechococcus) #yuck
#use a beta distribution - can't use poisson (not count data), negative binomial looked terrible
###If they are all betas, can we transform & then loop it
beta_trans_water_microbes <- dplyr::mutate(water.microbes.seabirds, RelAbund_Synechococcus = (RelAbund_Synechococcus*(n()-1) + 0.5)/n())
beta_trans_water_microbes <- dplyr::mutate(beta_trans_water_microbes, RelAbund_Litoricola = (RelAbund_Litoricola*(n()-1) + 0.5)/n())
beta_trans_water_microbes <- dplyr::mutate(beta_trans_water_microbes, RelAbund_Prochlorococcus = (RelAbund_Prochlorococcus*(n()-1) + 0.5)/n())
beta_trans_water_microbes <- dplyr::mutate(beta_trans_water_microbes, RelAbund_SAR86_Clade = (RelAbund_SAR86_Clade*(n()-1) + 0.5)/n())
beta_trans_water_microbes <- dplyr::mutate(beta_trans_water_microbes, RelAbund_Uncultured_Alteromonadaceaeae = (RelAbund_Uncultured_Alteromonadaceaeae*(n()-1) + 0.5)/n())
beta_trans_water_microbes <- dplyr::mutate(beta_trans_water_microbes, RelAbund_SAR116_Clade = (RelAbund_SAR116_Clade*(n()-1) + 0.5)/n())
beta_trans_water_microbes <- dplyr::mutate(beta_trans_water_microbes, RelAbund_SAR11_CladeIa = (RelAbund_SAR11_CladeIa*(n()-1) + 0.5)/n())
beta_trans_water_microbes <- dplyr::mutate(beta_trans_water_microbes, RelAbund_SAR11_CladeIb = (RelAbund_SAR11_CladeIb*(n()-1) + 0.5)/n())
beta_trans_water_microbes <- dplyr::mutate(beta_trans_water_microbes, RelAbund_Rhodospirillales_AEGEAN_169_marine_group = (RelAbund_Rhodospirillales_AEGEAN_169_marine_group*(n()-1) + 0.5)/n())
print(colnames(beta_trans_water_microbes))
columns <- c( "RelAbund_Synechococcus" , "RelAbund_Litoricola", "RelAbund_Prochlorococcus", "RelAbund_SAR86_Clade",
"RelAbund_Uncultured_Alteromonadaceaeae", "RelAbund_SAR116_Clade",
"RelAbund_SAR11_CladeIa", "RelAbund_SAR11_CladeIb","RelAbund_Rhodospirillales_AEGEAN_169_marine_group")
#Loop
dat <- beta_trans_water_microbes
models <- list()
for (i in columns) {
f <- formula(paste(i, "~ algae.N15*Exposure + (1|site.name)"))
models[[i]] <- glmmTMB(f, data=dat, family = beta_family(), na.action = na.omit)
print(Anova(models[[i]]))
}
#Cool - there are some taxa that ahve a significant relationship with algae N15 (no interactions), including:
# Synechococcus: ChiSq = 24.4740, p = 7.532e -07
# SAR 86: Chisq = 4.20, p = 0.04042
# SAR116: ChiSq = 5.45, p = 0.01947
#
wat.syn.beta <- glmmTMB(RelAbund_Synechococcus ~ algae.N15*Exposure+ (1|site.name), data=beta_trans_water_microbes, family = beta_family(), na.action = na.omit)
plot(resid(wat.syn.beta))
Anova(wat.syn.beta)
test(emtrends(wat.syn.beta, ~ Exposure, var = "algae.N15", adjust = "fdr"))
test(emtrends(wat.syn.beta, pairwise~Exposure, var = "algae.N15", adjust = "fdr"))
coral.nept.beta <- glmmTMB(RelAbund_Oceanospirillales_Neptuniibacter ~ algae.N15*Exposure+ (1|site.name), data=beta_trans_coral_microbes, family = beta_family(), na.action = na.omit)
Anova(coral.nept.beta)
test(emtrends(coral.nept.beta, ~ Exposure, var = "algae.N15", adjust = "fdr"))
test(emtrends(coral.nept.beta, pairwise~Exposure, var = "algae.N15", adjust = "fdr"))
###RelAbund_Endozoicomonas-----
coral.end.beta <- glmmTMB(RelAbund_Endozoicomonas ~ algae.N15*Exposure+ (1|site.name), data=beta_trans_coral_microbes, family = beta_family(), na.action = na.omit)
Anova(coral.end.beta)
test(emtrends(coral.end.beta, ~ Exposure, var = "algae.N15", adjust = "fdr"))
test(emtrends(coral.end.beta, ~ Exposure, var = "algae.N15", adjust = "fdr", lmer.df = "asymptotic"))
test(emtrends(coral.end.beta, pairwise~Exposure, var = "algae.N15", adjust = "fdr"))
